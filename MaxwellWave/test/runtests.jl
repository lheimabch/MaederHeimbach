using ParallelStencil, ParallelStencil.FiniteDifferences3D
using Test
using StaticArrays

@init_parallel_stencil(Threads, Float64, 3)

@testset "wave2d" begin
    include("../src/wave2D.jl")
    
    # init random data
    u_init = rand(5, 5)
    u_gold = copy(u_init)
    u_init = Data.Array(u_init)
    v_init = rand(5, 5)
    v_gold = copy(v_init)
    v_init = Data.Array(v_init)
    dt = rand(1)[1]
    _dx = rand(1)[1]
    _dy = rand(1)[1]
    c2 = rand(1)[1] 
    @parallel (1:size(u_init, 1)-2, 1:size(u_init, 2)-2) update_u!(u_init, v_init, dt)
    @parallel (1:size(u_init, 1), 1:size(u_init, 2)) update_v_nabla2!(u_init, v_init, dt, _dx, _dy, c2)
    u_final = Array(u_init)
    v_final = Array(v_init)

    # test if boundaries conditions are preserved through the kernels
    @test all(u_gold[1:end,1] .≈ u_final[1:end,1])
    @test all(u_gold[1:end,end] .≈ u_final[1:end,end])
    @test all(u_gold[1,1:end] .≈ u_final[1,1:end])
    @test all(u_gold[end,1:end] .≈ u_final[end,1:end])
    @test all(v_gold[1:end,1] .≈ v_final[1:end,1])
    @test all(v_gold[1:end,end] .≈ v_final[1:end,end])
    @test all(v_gold[1,1:end] .≈ v_final[1,1:end])
    @test all(v_gold[end,1:end] .≈ v_final[end,1:end])

    u_init = LinRange(0,rand(1)[1]+1,5)*LinRange(0,rand(1)[1]+1,5)'
    u_init = Data.Array(u_init)
    v_init = rand(5, 5)
    v_gold = copy(v_init)
    v_init = Data.Array(v_init)
    dt = rand(1)[1]
    _dx2 = rand(1)[1]
    _dy2 = rand(1)[1]
    c2 = rand(1)[1] 
    @parallel (1:size(u_init, 1), 1:size(u_init, 2)) update_v_nabla2!(u_init, v_init, dt, _dx2, _dy2, c2)

    # test if through a linear field the velocity is not updated, since nabla^2u is zero
    @test all(Array(v_init) .≈ v_gold)

    u_init = rand(5, 5)
    u_gold = copy(u_init)
    u_init = Data.Array(u_init)
    v_init = zeros(5,5)
    v_init = Data.Array(v_init)
    dt = rand(1)[1]
    @parallel (1:size(u_init, 1)-2, 1:size(u_init, 2)-2) update_u!(u_init, v_init, dt)
    u_final = Array(u_init)

    # test that there chance in the field if the velocity is zero
    @test all(u_final .== u_gold)
end

@testset "wave3D" begin
    include("../src/wave3D.jl")

    


    # reference tests
    # init random number
    ux_init = Data.Array([0.06416405778491785 0.24760016126448614 0.36491790962768056 0.7881112047377304 0.5660124531243144; 0.7283825621028936 0.26682363575137946 0.8581603259234105 0.6881926964790105 0.5611190579880438; 0.04801168433634384 0.8785553223854713 0.2371738589724095 0.5025597792592889 0.22969148577029752; 0.6223825846367566 0.15675150382618364 0.5041921475100427 0.9725550951113372 0.016881467239792336; 0.42677563886297953 0.3125000986718329 0.5203438546959266 0.004479819721892375 0.5200061787421203;;; 0.49237830304627805 0.7777053093260963 0.7414366358657908 0.5545654110924016 0.3807431294071789; 0.7928295654439893 0.38256896227696036 0.11501099037248064 0.41012907458882963 0.07694424473953954; 0.7463323911782378 0.37513468690571294 0.05624464053441891 0.635612264990048 0.5979329654224296; 0.6879874125918056 0.41636105111083355 0.47417041425202533 0.8046878152623848 0.9440519699973703; 0.7007811457219205 0.5088018535589868 0.4379982535374978 0.20437655953276146 0.7466721541313489;;; 0.30531358473109327 0.7013291767712979 0.3975367921793551 0.8298211190779882 0.32744267956598305; 0.5020503188252853 0.7987759135759951 0.7141413644857151 0.8468483979433045 0.21830798978965638; 0.5507991422924946 0.6222062882443933 0.0361582897989412 0.40500127184966006 0.09479092199421824; 0.6585255167008296 0.10149669379526272 0.293500027671039 0.6688732589880124 0.3086813943978791; 0.7424911574738756 0.952983864482965 0.6099416389883122 0.994922501497207 0.1022551932770086;;; 0.23738159706951034 0.9428027854318032 0.5948935449642858 0.5506460841171287 0.31274467267516337; 0.357321537151154 0.9518185279999966 0.3850510983394958 0.09989880778025773 0.26689284173473826; 0.5635621620635549 0.3784976280319511 0.23873539410094013 0.33385173038279525 0.7447543549463688; 0.5328776875937442 0.2811439182237534 0.9774627488438785 0.2554709426939257 0.1763848572023362; 0.46484566206777334 0.8900736905280435 0.5167671510069066 0.7631323573820948 0.06816098988472652;;; 0.5817054561096072 0.5346156831743639 0.14202764562703918 0.11323797084101983 0.24930919050777522; 0.48656715115201965 0.5805645497215174 0.49852961049827893 0.4069419743607151 0.7528941881857931; 0.959053449438907 0.872673533518919 0.7397025827396143 0.2648168331702796 0.24541236262246335; 0.9429595595884126 0.03163589936611366 0.6333760970290611 0.5434557695572462 0.6382751245932087; 0.5823082823616509 0.6801524738336128 0.07700058809311594 0.042112981012161654 0.5544599438679392])
    uy_init = Data.Array([0.7517513463468547 0.945927896108825 0.6631365163887885 0.7961713370650066 0.34630210345025614; 0.2509588492709438 0.9767360756852831 0.7819352982949188 0.8108335317102338 0.28350727582579016; 0.11223067529578068 0.5204644643719355 0.43406789376203647 0.22436336754802655 0.9245545503975359; 0.3890939870746116 0.7472500627420046 0.4218294179437644 0.010630486348175539 0.6626557690296158; 0.06562893256384328 0.3083817910405656 0.394760867180843 0.4440142752056304 0.9012656273318533;;; 0.8197551566266211 0.10446693415318276 0.40875858404337595 0.062292040511835456 0.5269049011190793; 0.17954864073136012 0.29451809309017407 0.14545258307601194 0.13681613515142232 0.3607815188550433; 0.6203530923140204 0.17539942246347362 0.5577883844804016 0.1946400876331087 0.25270496551031996; 0.12525695406183412 0.17214664200850904 0.7510868608745008 0.325527140081179 0.34191333552835335; 0.7182279345298083 0.08739379660294289 0.4438545944319616 0.2611010620963867 0.9394218548120813;;; 0.4278903802328846 0.6592534213726742 0.512624833278918 0.2546373821228406 0.7793265892136362; 0.3125022257170923 0.6569469434643721 0.889972305466809 0.007819661508237874 0.5556587150404219; 0.6162464904832499 0.8163195276535252 0.901346236778346 0.5367618875110592 0.032294998460331015; 0.8984673692477015 0.4172296794974323 0.8012235194773282 0.03824186314543898 0.803270309917268; 0.5388753895904352 0.23476081123101045 0.16045989656263238 0.7943371195368657 0.7230259709761316;;; 0.18262080973776507 0.420311829052491 0.4796063259317973 0.3777120309998395 0.2414920550920594; 0.24567063243460052 0.8229692534493727 0.9242273392025383 0.9402914167718657 0.643286721933017; 0.9549414474377942 0.06639045664185661 0.9176073958603249 0.1005934611415995 0.8205154215476866; 0.10040806218698817 0.19041438612654515 0.5390101152335934 0.29662570416082257 0.2846796275659208; 0.6307345879127231 0.32821878066079724 0.6252000408323456 0.9080433457221363 0.8991482236223322;;; 0.007031109272959246 0.6974644911312556 0.16623107130194248 0.27851972375325773 0.8414974360028132; 0.3369577075165131 0.16657819781091776 0.7265172872294077 0.8310908166356671 0.9185982574179106; 0.8622377651809227 0.7231434617936758 0.268757595867103 0.24028280018401738 0.6285068395601697; 0.6839935644526192 0.9584476402254553 0.6336006569527275 0.7728099686556122 0.5926475741634855; 0.4778761373378413 0.12977359724019344 0.8965461599691117 0.9171873350250137 0.21782042988962957])
    uz_init = Data.Array([0.203790145612608 0.921616747063175 0.023099155238558655 0.3437574949289147 0.6133052616716085; 0.3934963124413795 0.4380052203088167 0.4966613104087766 0.35412149428296535 0.9996698660791794; 0.8380200257275967 0.20135676438031747 0.010804948960864813 0.37974877805521157 0.06667098420239703; 0.03885659818296727 0.9624693907211691 0.8574291677993062 0.962860832300604 0.044379549001687724; 0.456660761348913 0.6316626342087202 0.04289685193816828 0.32145054004123264 0.38523082229106154;;; 0.23378195008326774 0.9296852581983411 0.33710287693184604 0.245742971564348 0.4307751962360201; 0.7873477956713086 0.6125662698357708 0.8506009549465212 0.06463414610214469 0.4101218937577601; 0.03743845468470486 0.467772651399311 0.7093041239537631 0.23817086113452923 0.6361501287194442; 0.8854025662976327 0.09631421189065448 0.7771759390226608 0.6562982915718704 0.5261742194191815; 0.6819286031854851 0.5387921268209498 0.9030649355274117 0.24653887630444415 0.894952750822887;;; 0.2280417277382274 0.59770162348274 0.13506094282679648 0.07023409118515977 0.6312883833801326; 0.00487370143803556 0.39323247549962914 0.13630780850010993 0.8826030363699618 0.4802422132844606; 0.18873244041315762 0.2581025484963252 0.7054503471125195 0.369288122773217 0.051756850858082126; 0.079624440178516 0.16523591854216813 0.44513564091603874 0.5473487429112659 0.6759222571643941; 0.25143030172547287 0.48681405239687936 0.843183932706196 0.4781221556495634 0.29896198232985416;;; 0.680330866898826 0.15845774051171402 0.2353287868647419 0.46250666838106436 0.9702604448588051; 0.9303548088752467 0.5932171093741679 0.5792689398830181 0.11985346518337936 0.028473333311919036; 0.009234556015967565 0.6344755660712468 0.24067705074982637 0.7127955152527604 0.8070985217980259; 0.5424884292175267 0.8324926873217534 0.40071350305223463 0.8578208091867587 0.7270374728728073; 0.6718051850827235 0.11954275687897098 0.048082561492946874 0.7590249307832292 0.6194371790689345;;; 0.7708243795763139 0.8014155995841953 0.058002484642140084 0.1882270452879542 0.23891477499058567; 0.023504921352116903 0.3418683041576258 0.24632976544038 0.4468508735515204 0.04280435702985563; 0.4431063793120362 0.6791140242199096 0.8374373707872518 0.44999444941331657 0.5729480213356086; 0.8929138564490979 0.47148571261089256 0.514783722752239 0.7100656500772773 0.04050728368218437; 0.8201122734267342 0.27832201978302096 0.20089375210281735 0.748412203035826 0.8115820363466881])
    vx_init = Data.Array([0.13576924452340033 0.45977120240429414 0.2913640562905633 0.837696393192376 0.6924993976438596; 0.3707211078946224 0.593475227872252 0.9033106973983509 0.36592863190941394 0.9021053083917392; 0.7239987710907816 0.6004883255006747 0.5152011534524102 0.6225366762482474 0.3168308988118089; 0.9004385853656172 0.4684522867837906 0.27055608968708666 0.5587114395853038 0.47310932857445764; 0.2562108787500269 0.028593077696345448 0.06077493951555635 0.27994020783789697 0.5039360947962053;;; 0.1184685019465197 0.6325310797022136 0.7369933872028099 0.9051859527425952 0.43413766060685854; 0.6233645406215765 0.28839087580112044 0.6458644120762087 0.3274252959493159 0.9877344678813051; 0.5594180606310173 0.6066959807645077 0.8987326804334177 0.78679892738228 0.5799429297659547; 0.8524039060604814 0.22095467864342078 0.22014522580425322 0.07699921785840069 0.6974915856603932; 0.912083822668242 0.7930789829854393 0.319597844022139 0.8670999977172114 0.2509058664836571;;; 0.39433250531874653 0.4772718841294381 0.7129192263003913 0.7433603812037715 0.24223763437625745; 0.7031162028221837 0.5427333685295759 0.41470817742534594 0.5141014405015479 0.2835707381308141; 0.5166495246123873 0.23851398259099044 0.5618420796291055 0.8803254758233373 0.11684203217665734; 0.7980494822608255 0.4166463337260231 0.06581834522168695 0.27225831662397026 0.23714896000827734; 0.8947021090935964 0.47311875672011816 0.37432703179307936 0.18501285356032193 0.7496593678321193;;; 0.025778710943046956 0.07685227491818636 0.14633485238345512 0.6421324359531133 0.035771262568981554; 0.24526555662727434 0.3130001253661824 0.6431293493072036 0.44638395809594145 0.08226017826672882; 0.6641241474337302 0.38765958409928836 0.46318209029874324 0.6277134953744101 0.3639785864506335; 0.7846101634470782 0.22495974187002055 0.438421956558563 0.9682256178234662 0.8721583224993468; 0.32176243014557104 0.12054901350168978 0.14530539338900617 0.7082962323357171 0.4520306134837938;;; 0.6197724358006799 0.21396993013753762 0.7158379710278252 0.8556788705627685 0.14780669133373636; 0.43808763359172365 0.5877261366023069 0.0795376889404944 0.843679301273059 0.16881572792744337; 0.5949438367769607 0.09145248081066648 0.4681311022879475 0.7059595459001609 0.9943309427484337; 0.34456813014856236 0.74099197030078 0.9389053014872544 0.12154337045422059 0.5422896200725732; 0.25036989898239415 0.2877315863034081 0.8022656863465558 0.8564142864717218 0.24822741355288203])
    vy_init = Data.Array([0.06305640207927066 0.3937265052439286 0.790767395715794 0.23373819824037811 0.9386673459543713; 0.8554748009989912 0.966810823670426 0.8562612160585285 0.9156337110518665 0.535539505604868; 0.8799066703747018 0.867207847025881 0.18229731783919445 0.6180943095251185 0.5815054733868158; 0.8894076425440864 0.0762704355874727 0.1919854207223558 0.37820323209433526 0.4479596131956647; 0.16543038013017852 0.8211938084103854 0.8545090935239854 0.505733287812237 0.18315253146148658;;; 0.8167420322195307 0.24900473364727715 0.5042258499903549 0.21288497699238373 0.2308279249798285; 0.6538259187605515 0.35225729058097344 0.38602777658098375 0.019686692174168297 0.5217431762503106; 0.7057980041964336 0.9082317948244928 0.17657044340674544 0.9357536201926614 0.0013169363269219803; 0.7518342194553059 0.4214891133700146 0.30481459322987603 0.16893004863690342 0.7227970295492021; 0.49795081371554506 0.15346261348176604 0.9873372060486477 0.2971310396050204 0.3545148948039408;;; 0.2898843339543199 0.9257821545871079 0.315512632022392 0.08943102074773202 0.8246627319814916; 0.4223957272390104 0.7632269734395485 0.37255178745796236 0.16082366838332662 0.2615009483273605; 0.4488891557320446 0.9360267300888616 0.4548648414288401 0.6993302505366364 0.8457415494777308; 0.6638908916399919 0.8713424555035402 0.3831866788274685 0.39968283158974405 0.5749184617928796; 0.07798846152777783 0.9731912724281412 0.17032390586137724 0.05145689127548725 0.4309513625968212;;; 0.7036851683344755 0.32391529682179276 0.07049627802266634 0.508872746036095 0.8241338718106261; 0.7197802532843559 0.2663463742300137 0.47367034287801 0.5659397963082188 0.23606909692023437; 0.6161127543447372 0.3958780199902754 0.30093827356466485 0.9923890101177398 0.6266545178524408; 0.5820829321838283 0.31257930020799696 0.9446741048989186 0.8300576884872707 0.11120756342277827; 0.5303984288423008 0.5387407308980946 0.7345683951466652 0.8078363334651198 0.8824992406529918;;; 0.16228947484989698 0.5901472054084315 0.1361519602236183 0.9995695432856658 0.3250407077811194; 0.6500034299444318 0.34488920347392527 0.33994305678573444 0.09714423514795933 0.8084244447978433; 0.3564823753615284 0.31341943622826063 0.6932249545391121 0.5941929089381263 0.5300365283140627; 0.8064192063745842 0.5417177955721331 0.9929059298725404 0.2636613644250987 0.1247356597559105; 0.028539590375629365 0.9992612568909075 0.87877902603646 0.10441479611024596 0.7372984147560009])
    vz_init = Data.Array([0.6796886263031019 0.0546987194786932 0.6544840742896139 0.2690581973421958 0.6163993206531809; 0.8978697823907873 0.48799619979859743 0.3360350809417053 0.3756416071171593 0.696855253084969; 0.06042283791825087 0.006816545656897821 0.47343412206244173 0.5008910996855729 0.8637826121027783; 0.6520160335501194 0.729914088517108 0.7932874718005488 0.645300139186034 0.6917308325421467; 0.48297946063054586 0.6874946836308082 0.6655727302526888 0.5281794298687704 0.8180220983257649;;; 0.3429264423231425 0.17791638287647582 0.3529795698043975 0.07914617259601409 0.9276638393800479; 0.7312911285136041 0.9377960716929602 0.6758825924624461 0.7020153486520572 0.406046995073139; 0.03619962176802749 0.08486151323601854 0.3407366694192667 0.6018174559223972 0.16418964646660306; 0.5226476466668541 0.06132505447030179 0.7666211269183055 0.14127418052790341 0.33645181765921395; 0.4710300473568916 0.3757855789673571 0.4246863566184772 0.5856856488517632 0.7875463861707878;;; 0.21019034222004251 0.4221542818381374 0.9434792311999551 0.9710920433094289 0.4720655280941709; 0.4143686777159752 0.6396352503511326 0.40072295183968576 0.18976181461539077 0.11697005242898784; 0.9475559631990929 0.5237293705890336 0.08356035011673446 0.3334303074832925 0.5570055497649916; 0.08045722999366534 0.13698568806093214 0.1370374572346592 0.03397481975615502 0.4310361638095087; 0.3549665240710188 0.7539543722435816 0.8875422548807369 0.07752759288011224 0.5320968388689262;;; 0.2240840381581508 0.09920036335177973 0.011833805913921691 0.2412123092940771 0.6464272282256478; 0.17933789106888387 0.4650586941873651 0.8065645073938796 0.06908970309134399 0.2716035773417844; 0.47933345603860933 0.5702447165259281 0.27090503626441953 0.07248212288312528 0.6529240592998058; 0.1237753154904947 0.5781754727101263 0.7786812905225562 0.6918105550087184 0.8907286921339608; 0.5758763609413203 0.9867993525333909 0.8395654337107887 0.49096563517873404 0.579112968837231;;; 0.636704267643127 0.7115288507739786 0.11958883078305438 0.004867374248304079 0.8820252138292536; 0.21041439401592854 0.5682697267131694 0.18452813762216336 0.6222005435045196 0.7247691614476025; 0.719541669903262 0.5167990381072305 0.07471754218634452 0.30236026453135234 0.8089542968750867; 0.6256510436014113 0.740074019506953 0.6355031487310929 0.18365527593174946 0.19498401848779312; 0.6394670130068828 0.9933671763203821 0.8218024998081985 0.6734579451764313 0.3673290306983388])

    # for boundary check
    ux_boundary = copy(Array(ux_init))
    uy_boundary = copy(Array(uy_init))
    uz_boundary = copy(Array(uz_init))
    vx_boundary = copy(Array(vx_init))
    vy_boundary = copy(Array(vy_init))
    vz_boundary = copy(Array(vz_init))

    # init random number
    dt      = 0.4946809748957348
    _dx2    = 0.5417552829333563
    _dy2    = 0.19823784619704365
    _dz2    = 0.1008400576954277
    alpha   = Data.Array([0.47604793386056776 0.9509206064386824 0.28781591236255843 0.7446418017608756 0.021527790981939576; 0.9567237533404881 0.6776950570485913 0.9037347690019867 0.9508832205005434 0.008906915232682944; 0.09744279077430162 0.35752177042874367 0.041954627472292616 0.06280446685683638 0.11992419870772142; 0.13365353894015186 0.1466499120177578 0.8895744277213776 0.7970215039117291 0.5553539561734457; 0.6148190815607483 0.39359996056894797 0.5546165912738626 0.6054009690755865 0.7534343187471881;;; 0.05353537318122592 0.34442261195540225 0.6791995137800815 0.41691756531315716 0.34139826241615345; 0.5617347379894798 0.07072921822156153 0.5092341924970651 0.7985318715468591 0.25500750141595985; 0.3310155389713838 0.5486272225634302 0.8985892041890668 0.8419900761725386 0.9373211238840189; 0.45007437508467163 0.47108018677031593 0.8950303073088922 0.05145951635689738 0.6105661710730812; 0.4923698132657678 0.8595654198348558 0.3986936932807843 0.500146666142975 0.35022832880289534;;; 0.6614019018022586 0.9749883889041462 0.16926388914691504 0.4655171451210275 0.09831374151160821; 0.1866185016022942 0.7673142732746064 0.8089437302299358 0.19551906782004047 0.4119599138439445; 0.3757518487353131 0.3200365480946601 0.0800804689536927 0.1701895718303399 0.8767473385801936; 0.9887104903480923 0.10502323709340589 0.9210382002684169 0.12448959237372414 0.4123923372605529; 0.07171226867471836 0.2140720350118791 0.3465943921285004 0.4849672783161072 0.4600167112668566;;; 0.35877454670942954 0.7287557980175963 0.516528161021157 0.20120346237957132 0.7914148537508573; 0.5936990017906753 0.35484956302867365 0.5094661638296604 0.8838442018096154 0.07118291940648114; 0.3991892523525199 0.7684368197108669 0.7907192771084224 0.27958917736488376 0.8804654423383002; 0.42604345398933574 0.19081029966008123 0.919341244837094 0.594764094371781 0.011732509266629831; 0.7377898070219802 0.01854581144905576 0.2584916942407497 0.47446874574258324 0.20485757774282887;;; 0.09763041727058619 0.45724750007780657 0.7730236393015504 0.506893057003144 0.3697851593666659; 0.926754769902492 0.7977532368566259 0.934729065239888 0.6080343173587744 0.882243391470389; 0.7602222889996447 0.6661921423338264 0.8863604669079435 0.2673919399827098 0.35864376764967176; 0.9083756049173839 0.1910988470130357 0.10890070187820944 0.09197509663504821 0.6960937048693441; 0.5742530232697011 0.4736802507331759 0.8692374677545969 0.7846455029749094 0.8321988464889284])
    beta    = Data.Array([0.5532351001888247 0.5031962209694639 0.898343900246309 0.7345446954035706 0.3378042905858083; 0.9223569771065738 0.36370555706626906 0.9606322108483295 0.9697839234853108 0.30921207550759444; 0.10292751115478616 0.31330814202987267 0.43716327800533106 0.027487545201372088 0.9484709591703053; 0.21960545066831827 0.4641459856392539 0.7622984611614982 0.5831111995390748 0.28088381516955097; 0.4213091577608846 0.001057870307770603 0.923824555416356 0.6466180245228186 0.23844735030479636;;; 0.4021644450630344 0.4956227425475901 0.9287390020229866 0.9209492750292765 0.009300007232424634; 0.8890154768444838 0.9792688942218075 0.6900761813943053 0.9755288386568342 0.005628866118518094; 0.0631802288293859 0.969712085028847 0.3723723082862286 0.8078818237839182 0.24102396194979092; 0.21442864591605193 0.04309162224195029 0.8801879294084509 0.1433010439423884 0.05351841588476214; 0.9532895779144264 0.6722390687919726 0.4147866990953145 0.41645885335919375 0.5469221120288598;;; 0.6079338126676419 0.7433896456398957 0.3636492856852218 0.6765098879253442 0.38239136091290904; 0.3036142446149066 0.5013749461878457 0.04324597714913825 0.15839231190933456 0.31301319447281784; 0.614219100379737 0.36081341872456907 0.6326059646878651 0.48242376448068347 0.45103144032921383; 0.33007491438126757 0.49756679772158396 0.6055750679534867 0.013179320346499268 0.4277192378533984; 0.5711752741534204 0.4254863722142104 0.2664009883192918 0.4256718526756864 0.4544969647431518;;; 0.6272121833158721 0.5863290751376773 0.8291421083577735 0.10064768192453499 0.6636119686012077; 0.0397767393545001 0.6994519627148801 0.4506303572725817 0.36310279240603993 0.15236344091273324; 0.9863909288795761 0.2044712077519394 0.10080247892340544 0.6771060582470941 0.7833628942629799; 0.31306310446385055 0.41679231527219096 0.5720443222573803 0.6153258830730308 0.06673225790582848; 0.9365392004965697 0.6529227022869243 0.14945482794641807 0.5661054524048196 0.9926911262122211;;; 0.15500094884061633 0.4380696306907895 0.9864917544532024 0.5271013378397337 0.48021053064845454; 0.6067785867601158 0.17323870187745638 0.6180041345605766 0.9658621753966053 0.09066109248774679; 0.5029139396498078 0.214831867006249 0.8339280147454347 0.8037009403460147 0.7250002268611628; 0.34850201810181214 0.26984406520968585 0.16317636727868456 0.7374252418477376 0.5984085690264985; 0.8584062622335554 0.420261208895392 0.9646870339353346 0.8299728244231674 0.22107666100872903])
    gamma   = Data.Array([0.1693688402046738 0.09515074307643023 0.9770993458335806 0.8981252404497033 0.7399704356496005; 0.7433680493677285 0.6177929071251931 0.33317019007222437 0.549769293905881 0.47052077195620257; 0.5977427766246066 0.13362615800678224 0.05901398033159466 0.1436727699680752 0.06390287825015617; 0.8860483874622289 0.5425443446165535 0.1297601929656329 0.2612926654964547 0.8940928377857467; 0.09318046991368778 0.6401791263219994 0.20168652481679994 0.3310449737081953 0.4043209261434536;;; 0.6566940415373519 0.6400325793753041 0.3686126843611328 0.9011855475684388 0.788284353803135; 0.8871198037302458 0.24505299720690987 0.3013115275187215 0.8886764291143382 0.03613446074811666; 0.5443354857551765 0.6303207847446013 0.9998063980106838 0.7998134413103365 0.6992583528194029; 0.881596804219737 0.15900389480573485 0.5940462963087932 0.12182159751917132 0.31768131061332683; 0.10188691903699643 0.5038847466250604 0.4671602551295351 0.787432134801362 0.7410522739467722;;; 0.03889875433364698 0.2773337237859853 0.28332229915084206 0.6172088874034278 0.43213205149306244; 0.5603885529414631 0.9378892328348973 0.1225497824537557 0.810164498362226 0.07199910639519136; 0.9780279199210379 0.8078044325810962 0.12703652101951712 0.8762533179861626 0.41449779055125424; 0.6476970501467766 0.14833225689342977 0.06764646556731702 0.560031855270915 0.8887794533267709; 0.9467414568337974 0.9436822131181232 0.3443219117875025 0.6489540571124021 0.7894599801304137;;; 0.7391466711170654 0.8607574648931069 0.28116321639770425 0.3621423124154347 0.11751646392864157; 0.4313844473008115 0.24640394505190877 0.2542402079522389 0.41265309629674407 0.02393123795353025; 0.32248714514406573 0.526027381896715 0.36072252016042994 0.524528731151827 0.7942671402149387; 0.9296205595934904 0.7220042600727793 0.325955516855266 0.04225451604567709 0.18746924333231663; 0.637293778823535 0.4444083506930011 0.3746244243153408 0.8602402855149746 0.9478471177985578;;; 0.5906103398452588 0.6163446983422405 0.18318584194487475 0.5630815288754211 0.29136445114280674; 0.39865052573889725 0.7815046559368388 0.9919099635543046 0.2757460345156132 0.06668010554104331; 0.9129130554216817 0.2151073451668052 0.3307144606859027 0.445495636115232 0.14804325353890724; 0.7259772774844471 0.7979505035482715 0.3192890568041097 0.34015142920255037 0.4179092883635518; 0.9410572548623531 0.6094455413494438 0.9706115136545147 0.8574792844241572 0.6850868790747235])
    _dx_2   = 0.767031908238001
    _dy_2   = 0.4899811439084948
    _dz_2   = 0.7939782773150603
    etax    = Data.Array([0.8815047034532819 0.5113049578945217 0.9795998308143687 0.5653420999833322 0.8643176888829576; 0.38930211682181093 0.8078446548397277 0.3984591912082035 0.7653714134087297 0.324009219988479; 0.8384169174115528 0.783394742727376 0.9768255056820508 0.24610962142305304 0.8054566179779641; 0.70597483151499 0.6704305583147977 0.27685857814092274 0.21326014516378033 0.5394773558639367; 0.968013761869848 0.12510872362942016 0.5635781885380714 0.26154009434990255 0.7350898380790832;;; 0.146173735550993 0.37142994427857934 0.7234420774691367 0.13161894840729604 0.9865890227998211; 0.902104345443815 0.08624849214510599 0.21748114931066054 0.567735890654211 0.4356127163081127; 0.3709280396876856 0.28288230750540844 0.28695221226734413 0.8521100432630065 0.389599591591548; 0.3090652483375854 0.05478047692808541 0.8988007973844141 0.37356759523235505 0.003995452969826174; 0.6234582881186668 0.6767090037985455 0.004114977621850313 0.8227772089019152 0.0835519881755995;;; 0.7579085043114183 0.7317431277481439 0.8950392795768475 0.10349213553592718 0.4591023832883332; 0.08043564956438587 0.7249938808608442 0.04070849249860187 0.5901773956256389 0.432530131986004; 0.06504791735535687 0.9136589948250037 0.5605586589424598 0.4698254007962681 0.6524887731769426; 0.3592027428456087 0.27384603425221876 0.08973255377347888 0.4063878645787705 0.686635735406388; 0.10172629519394272 0.06492096179559104 0.18311041981839105 0.30169565347914995 0.9678307078624445;;; 0.25289473570912135 0.173601249318041 0.7388801642749802 0.5919884860605988 0.25960052034198755; 0.1996434095072136 0.504898215157983 0.19880614993058587 0.0028717387044769893 0.24608956053442865; 0.7765586297280758 0.09244133453107206 0.5154386332288765 0.6252732054674164 0.3190706497080963; 0.9598696563691632 0.8497051642483702 0.4621693060593045 0.9587016658980245 0.8868081065221328; 0.4228424800594771 0.6840618565265578 0.9212780136786307 0.32588033689260076 0.6465550888778215;;; 0.8936836679898027 0.2783032041293767 0.25226518083062177 0.8639693307742856 0.4339536730984459; 0.4815988903033457 0.06630773360903652 0.7994270695339594 0.5965523624584623 0.2618503742070656; 0.8433892939007553 0.5881287958620813 0.10421604872440415 0.7761467401582671 0.6524484337611025; 0.6805357400543938 0.31410686291566514 0.6981347999991969 0.9272008505176038 0.34439645680447084; 0.023052456789618647 0.9213877793480101 0.36268668343299026 0.6775093257999699 0.7477585787758183])
    etay    = Data.Array([0.8084181218355115 0.1673928324516123 0.08819210951390988 0.6295094890096963 0.44920346544626577; 0.4516425511569746 0.22929863847382737 0.14142435064487846 0.14441712412076324 0.6699397866288705; 0.4967034531750175 0.30128712777549194 0.20349916002003599 0.47738370001438335 0.06308960822587006; 0.7372432122974039 0.715066870365515 0.9258940565402065 0.001808368984310249 0.09022375792506865; 0.35842589616933707 0.41039598869706884 0.33641723197131934 0.16590408073126883 0.3614006432779341;;; 0.5873806345661619 0.28350655838324534 0.2955769110012252 0.4021958234097479 0.7457193408023126; 0.7343913505876346 0.26353406095183685 0.6105075687442011 0.1637204514790742 0.44197989344962296; 0.5566081787904192 0.661942216238531 0.9949039706431068 0.3137128738147361 0.9792961355845; 0.08476531923264718 0.6331354381949933 0.8257662813257298 0.26070794630841765 0.17207126674150153; 0.8212282621413572 0.6332295797840649 0.7748370487166859 0.24858473779890744 0.47145894753996287;;; 0.5396246557788388 0.04170494238266953 0.2480253110726367 0.016576826427534774 0.24499466201540743; 0.29448413583924615 0.6412034408820774 0.01167508799177841 0.36358167429802823 0.10183107897237231; 0.9102274564175604 0.832904971542648 0.588712416789132 0.36913920650880383 0.8600551906392038; 0.41614606211447003 0.08401257507143123 0.9492052744616144 0.005857856526153782 0.8371097589433332; 0.9923747231444721 0.012170522688916718 0.5057235145431961 0.7781163208118039 0.2708096948719664;;; 0.2487701340613535 0.6942471255194249 0.9207134122860199 0.18589502406965408 0.874300202205391; 0.658341853808866 0.10340092831677916 0.3185642539649426 0.2929487421452587 0.8932186646537073; 0.7867530806964529 0.376167377640961 0.1872739040583059 0.7603897614153872 0.5381834983292403; 0.8564176525543656 0.4165706086050338 0.2729748611973971 0.24356600405299655 0.9413830819933627; 0.5486292890491897 0.012098430506317648 0.5774886953096345 0.8654739782276856 0.1984953162345331;;; 0.6300407539487206 0.20737877187474496 0.02131858970694378 0.3143940729496829 0.17793956000091993; 0.7654410901467041 0.2929639552408999 0.08538982058724653 0.5558711649860419 0.9686142471800845; 0.7980096059018319 0.7796681687363926 0.8959938008925207 0.08073751732341683 0.9433319253661602; 0.7715019303064539 0.02222263328254004 0.7561831748310665 0.6973392559380373 0.07793020633834236; 0.9868781684737862 0.4612590711660348 0.27311119071429935 0.4568102848763861 0.37538240458593697])
    etaz    = Data.Array([0.41349999983828867 0.44341649079895284 0.5955399576235463 0.19358323412426404 0.5274990315295405; 0.6998136736021682 0.6593273833419413 0.08225773001312786 0.7391480503537766 0.20269259934276818; 0.9528030443772086 0.7473235674795 0.7313314485340593 0.029734512237986843 0.5426403171568931; 0.6336379901627085 0.4603876166379488 0.24713023628490316 0.6627908288916621 0.9207211645369682; 0.6171102451407837 0.7779081637120413 0.31939722396645087 0.7704559172442158 0.2551323779838397;;; 0.23371271901003043 0.5149656337779585 0.6111666951832223 0.6400361278052351 0.721082360803625; 0.6830831624594432 0.03826214778780257 0.20899022898518227 0.04429417986696005 0.41144793010384395; 0.3707203356315839 0.019737162352264193 0.638070657253709 0.5355054130563691 0.5271522688434069; 0.09298867363885455 0.011333267183333273 0.7843578754262981 0.5947059411221904 0.20879627133364387; 0.6366170257993791 0.208449947987557 0.8537760186599742 0.9347597941991767 0.6971803372234051;;; 0.343055471572829 0.20450340879533757 0.525102718225917 0.5462680421917872 0.7157649452215818; 0.15640420679704758 0.0648821687876675 0.20610681459777236 0.08652958756220008 0.4318282157900698; 0.21165411129911893 0.06642720660253065 0.18020648539722206 0.4145677690982402 0.7417183118810106; 0.8439229505441616 0.9369406595877222 0.7057776166452763 0.8209285122909105 0.7183284479866916; 0.976458802860721 0.47622774397266 0.08715551652286901 0.6820291192069246 0.8485700881205834;;; 0.47027157933185015 0.9513398869149536 0.45538275691694474 0.14843867094476781 0.34319176707429055; 0.7733302987716982 0.027486069189696205 0.2955498368510734 0.3265166981725379 0.5072224529841809; 0.8520892606627639 0.9379152703209594 0.2383205506386299 0.35366996035603104 0.6000728039246175; 0.8255441569034172 0.3918523735763295 0.018634432913182564 0.042103510960370905 0.7127245495464453; 0.26547809401092903 0.6072309902623476 0.9745826860641865 0.9709076820429536 0.3556384352886739;;; 0.658949970128574 0.3681599394180153 0.28152764896949767 0.7647809594189143 0.7611391498012886; 0.05920297578458655 0.28442243177942017 0.48318726549255453 0.0013029750385620265 0.02703341777989332; 0.6021563902881459 0.40438567811209825 0.6281166048927757 0.8911764850174755 0.7890031573623199; 0.9423787901017718 0.4353136993310337 0.3119603160560751 0.790898431518033 0.73830238809524; 0.684730195919063 0.736156825123377 0.7375473286165916 0.6048690284197613 0.20000541615876188])

    # init gold solution
    ux_gold = [0.06416405778491785 0.24760016126448614 0.36491790962768056 0.7881112047377304 0.5660124531243144; 0.7283825621028936 0.26682363575137946 0.8581603259234105 0.6881926964790105 0.5611190579880438; 0.04801168433634384 0.8785553223854713 0.2371738589724095 0.5025597792592889 0.22969148577029752; 0.6223825846367566 0.15675150382618364 0.5041921475100427 0.9725550951113372 0.016881467239792336; 0.42677563886297953 0.3125000986718329 0.5203438546959266 0.004479819721892375 0.5200061787421203;;; 0.49237830304627805 0.7777053093260963 0.7414366358657908 0.5545654110924016 0.3807431294071789; 0.7928295654439893 0.6319034877360227 0.5962750306077533 0.8540034692574583 0.07694424473953954; 0.7463323911782378 0.8775323832321137 1.104696183819172 1.3317831046987778 0.5979329654224296; 0.6879874125918056 0.5678210515702986 0.6741394567286401 0.8646873796814396 0.9440519699973703; 0.7007811457219205 0.5088018535589868 0.4379982535374978 0.20437655953276146 0.7466721541313489;;; 0.30531358473109327 0.7013291767712979 0.3975367921793551 0.8298211190779882 0.32744267956598305; 0.5020503188252853 1.307731718316993 0.8343993294755906 1.2162952355831758 0.21830798978965638; 0.5507991422924946 0.7535852836115778 0.3676527151947896 1.0973556247082086 0.09479092199421824; 0.6585255167008296 0.3419629690448295 0.3357011218468382 0.8539945749668606 0.3086813943978791; 0.7424911574738756 0.952983864482965 0.6099416389883122 0.994922501497207 0.1022551932770086;;; 0.23738159706951034 0.9428027854318032 0.5948935449642858 0.5506460841171287 0.31274467267516337; 0.357321537151154 1.233383098747469 0.7437746036804654 0.534324122656934 0.26689284173473826; 0.5635621620635549 0.7289799003229287 0.6509736326191224 0.7731058572072181 0.7447543549463688; 0.5328776875937442 0.4953509006454117 1.1876061984555017 0.9973154476792828 0.1763848572023362; 0.46484566206777334 0.8900736905280435 0.5167671510069066 0.7631323573820948 0.06816098988472652;;; 0.5817054561096072 0.5346156831743639 0.14202764562703918 0.11323797084101983 0.24930919050777522; 0.48656715115201965 0.5805645497215174 0.49852961049827893 0.4069419743607151 0.7528941881857931; 0.959053449438907 0.872673533518919 0.7397025827396143 0.2648168331702796 0.24541236262246335; 0.9429595595884126 0.03163589936611366 0.6333760970290611 0.5434557695572462 0.6382751245932087; 0.5823082823616509 0.6801524738336128 0.07700058809311594 0.042112981012161654 0.5544599438679392]
    uy_gold = [0.7517513463468547 0.945927896108825 0.6631365163887885 0.7961713370650066 0.34630210345025614; 0.2509588492709438 0.9767360756852831 0.7819352982949188 0.8108335317102338 0.28350727582579016; 0.11223067529578068 0.5204644643719355 0.43406789376203647 0.22436336754802655 0.9245545503975359; 0.3890939870746116 0.7472500627420046 0.4218294179437644 0.010630486348175539 0.6626557690296158; 0.06562893256384328 0.3083817910405656 0.394760867180843 0.4440142752056304 0.9012656273318533;;; 0.8197551566266211 0.10446693415318276 0.40875858404337595 0.062292040511835456 0.5269049011190793; 0.17954864073136012 0.5489800507630829 0.4733517941261878 0.21609966440685574 0.3607815188550433; 0.6203530923140204 0.8893484421972029 0.7126141742284551 0.9043548892122115 0.25270496551031996; 0.12525695406183412 0.4930499461944647 1.0357015809054815 0.41533753953424835 0.34191333552835335; 0.7182279345298083 0.08739379660294289 0.4438545944319616 0.2611010620963867 0.9394218548120813;;; 0.4278903802328846 0.6592534213726742 0.512624833278918 0.2546373821228406 0.7793265892136362; 0.3125022257170923 1.2967953636981804 0.9484342814313301 0.18072077340776038 0.5556587150404219; 0.6162464904832499 1.487011601886918 1.2692781407681504 1.0452341144378645 0.032294998460331015; 0.8984673692477015 0.9426838735278968 1.0429608047694896 0.3352359848984831 0.803270309917268; 0.5388753895904352 0.23476081123101045 0.16045989656263238 0.7943371195368657 0.7230259709761316;;; 0.18262080973776507 0.420311829052491 0.4796063259317973 0.3777120309998395 0.2414920550920594; 0.24567063243460052 1.0157329308282188 1.2336505114331722 1.1315048241749432 0.643286721933017; 0.9549414474377942 0.46708824936786836 0.9678605012215145 0.8423640720285072 0.8205154215476866; 0.10040806218698817 0.41972490486974245 1.1696096258553 0.8279536857361698 0.2846796275659208; 0.6307345879127231 0.32821878066079724 0.6252000408323456 0.9080433457221363 0.8991482236223322;;; 0.007031109272959246 0.6974644911312556 0.16623107130194248 0.27851972375325773 0.8414974360028132; 0.3369577075165131 0.16657819781091776 0.7265172872294077 0.8310908166356671 0.9185982574179106; 0.8622377651809227 0.7231434617936758 0.268757595867103 0.24028280018401738 0.6285068395601697; 0.6839935644526192 0.9584476402254553 0.6336006569527275 0.7728099686556122 0.5926475741634855; 0.4778761373378413 0.12977359724019344 0.8965461599691117 0.9171873350250137 0.21782042988962957]
    uz_gold = [0.203790145612608 0.921616747063175 0.023099155238558655 0.3437574949289147 0.6133052616716085; 0.3934963124413795 0.4380052203088167 0.4966613104087766 0.35412149428296535 0.9996698660791794; 0.8380200257275967 0.20135676438031747 0.010804948960864813 0.37974877805521157 0.06667098420239703; 0.03885659818296727 0.9624693907211691 0.8574291677993062 0.962860832300604 0.044379549001687724; 0.456660761348913 0.6316626342087202 0.04289685193816828 0.32145054004123264 0.38523082229106154;;; 0.23378195008326774 0.9296852581983411 0.33710287693184604 0.245742971564348 0.4307751962360201; 0.7873477956713086 1.286223833862586 1.2410048148064643 0.6778982548459266 0.4101218937577601; 0.03743845468470486 0.6259505676732168 1.0545210183696776 0.8452946331000396 0.6361501287194442; 0.8854025662976327 0.15368191527254957 1.4543446222128 0.7464212030220331 0.5261742194191815; 0.6819286031854851 0.5387921268209498 0.9030649355274117 0.24653887630444415 0.894952750822887;;; 0.2280417277382274 0.59770162348274 0.13506094282679648 0.07023409118515977 0.6312883833801326; 0.00487370143803556 0.9582612043860463 0.5182372371560278 0.9763842456727938 0.4802422132844606; 0.18873244041315762 0.6870397569128925 0.8345815872435292 0.6668040584355799 0.051756850858082126; 0.079624440178516 0.27745020454512614 0.47495437191618006 0.556994574440485 0.6759222571643941; 0.25143030172547287 0.48681405239687936 0.843183932706196 0.4781221556495634 0.29896198232985416;;; 0.680330866898826 0.15845774051171402 0.2353287868647419 0.46250666838106436 0.9702604448588051; 0.9303548088752467 0.8758854907595286 1.0677322237350573 0.3729747302933263 0.028473333311919036; 0.009234556015967565 0.9989013536792963 0.5551704489835496 0.8480152212295133 0.8070985217980259; 0.5424884292175267 1.2593512012176704 0.8783499213472703 1.3945975447228633 0.7270374728728073; 0.6718051850827235 0.11954275687897098 0.048082561492946874 0.7590249307832292 0.6194371790689345;;; 0.7708243795763139 0.8014155995841953 0.058002484642140084 0.1882270452879542 0.23891477499058567; 0.023504921352116903 0.3418683041576258 0.24632976544038 0.4468508735515204 0.04280435702985563; 0.4431063793120362 0.6791140242199096 0.8374373707872518 0.44999444941331657 0.5729480213356086; 0.8929138564490979 0.47148571261089256 0.514783722752239 0.7100656500772773 0.04050728368218437; 0.8201122734267342 0.27832201978302096 0.20089375210281735 0.748412203035826 0.8115820363466881]
    vx_gold = [0.13576924452340033 0.45977120240429414 0.2913640562905633 0.837696393192376 0.6924993976438596; 0.3707211078946224 0.593475227872252 0.9033106973983509 0.36592863190941394 0.9021053083917392; 0.7239987710907816 0.6004883255006747 0.5152011534524102 0.6225366762482474 0.3168308988118089; 0.9004385853656172 0.4684522867837906 0.27055608968708666 0.5587114395853038 0.47310932857445764; 0.2562108787500269 0.028593077696345448 0.06077493951555635 0.27994020783789697 0.5039360947962053;;; 0.1184685019465197 0.6325310797022136 0.7369933872028099 0.9051859527425952 0.43413766060685854; 0.6233645406215765 0.504030957551208 0.9728776012392835 0.8972942506272557 0.9877344678813051; 0.5594180606310173 1.0155993899548945 2.11944990103114 1.4073127430369918 0.5799429297659547; 0.8524039060604814 0.30617712858552654 0.4042383932771272 0.121289411689425 0.6974915856603932; 0.912083822668242 0.7930789829854393 0.319597844022139 0.8670999977172114 0.2509058664836571;;; 0.39433250531874653 0.4772718841294381 0.7129192263003913 0.7433603812037715 0.24223763437625745; 0.7031162028221837 1.0288566380550044 0.24310206192025596 0.7468385816085622 0.2835707381308141; 0.5166495246123873 0.26558327899081957 0.6701175954173664 1.3995976962818875 0.11684203217665734; 0.7980494822608255 0.4861037465616107 0.0853097174086673 0.37422364184890416 0.23714896000827734; 0.8947021090935964 0.47311875672011816 0.37432703179307936 0.18501285356032193 0.7496593678321193;;; 0.025778710943046956 0.07685227491818636 0.14633485238345512 0.6421324359531133 0.035771262568981554; 0.24526555662727434 0.569184151071948 0.7251613131404108 0.8781928898079034 0.08226017826672882; 0.6641241474337302 0.7085016203925159 0.8333416068913321 0.8879543566780703 0.3639785864506335; 0.7846101634470782 0.433020458219173 0.4248060068530344 1.499642279838471 0.8721583224993468; 0.32176243014557104 0.12054901350168978 0.14530539338900617 0.7082962323357171 0.4520306134837938;;; 0.6197724358006799 0.21396993013753762 0.7158379710278252 0.8556788705627685 0.14780669133373636; 0.43808763359172365 0.5877261366023069 0.0795376889404944 0.843679301273059 0.16881572792744337; 0.5949438367769607 0.09145248081066648 0.4681311022879475 0.7059595459001609 0.9943309427484337; 0.34456813014856236 0.74099197030078 0.9389053014872544 0.12154337045422059 0.5422896200725732; 0.25036989898239415 0.2877315863034081 0.8022656863465558 0.8564142864717218 0.24822741355288203]
    vy_gold = [0.06305640207927066 0.3937265052439286 0.790767395715794 0.23373819824037811 0.9386673459543713; 0.8554748009989912 0.966810823670426 0.8562612160585285 0.9156337110518665 0.535539505604868; 0.8799066703747018 0.867207847025881 0.18229731783919445 0.6180943095251185 0.5815054733868158; 0.8894076425440864 0.0762704355874727 0.1919854207223558 0.37820323209433526 0.4479596131956647; 0.16543038013017852 0.8211938084103854 0.8545090935239854 0.505733287812237 0.18315253146148658;;; 0.8167420322195307 0.24900473364727715 0.5042258499903549 0.21288497699238373 0.2308279249798285; 0.6538259187605515 0.5143960867436683 0.6628498521077912 0.16027204052499533 0.5217431762503106; 0.7057980041964336 1.4432514205427247 0.31298108802483554 1.4346919279212047 0.0013169363269219803; 0.7518342194553059 0.6487075923095552 0.5753500427037237 0.1815521598986072 0.7227970295492021; 0.49795081371554506 0.15346261348176604 0.9873372060486477 0.2971310396050204 0.3545148948039408;;; 0.2898843339543199 0.9257821545871079 0.315512632022392 0.08943102074773202 0.8246627319814916; 0.4223957272390104 1.2934566977609578 0.11818116914005682 0.34952043978640035 0.2615009483273605; 0.4488891557320446 1.355807294539185 0.7437761358567596 1.027879083148442 0.8457415494777308; 0.6638908916399919 1.0622082123558843 0.4886730995529248 0.6003750635763632 0.5749184617928796; 0.07798846152777783 0.9731912724281412 0.17032390586137724 0.05145689127548725 0.4309513625968212;;; 0.7036851683344755 0.32391529682179276 0.07049627802266634 0.508872746036095 0.8241338718106261; 0.7197802532843559 0.38967271263964703 0.625500449650104 0.38653883433334 0.23606909692023437; 0.6161127543447372 0.810012539516944 0.10158689723570126 1.4994929025585684 0.6266545178524408; 0.5820829321838283 0.46355233045202454 1.2747599819350632 1.0740821024850138 0.11120756342277827; 0.5303984288423008 0.5387407308980946 0.7345683951466652 0.8078363334651198 0.8824992406529918;;; 0.16228947484989698 0.5901472054084315 0.1361519602236183 0.9995695432856658 0.3250407077811194; 0.6500034299444318 0.34488920347392527 0.33994305678573444 0.09714423514795933 0.8084244447978433; 0.3564823753615284 0.31341943622826063 0.6932249545391121 0.5941929089381263 0.5300365283140627; 0.8064192063745842 0.5417177955721331 0.9929059298725404 0.2636613644250987 0.1247356597559105; 0.028539590375629365 0.9992612568909075 0.87877902603646 0.10441479611024596 0.7372984147560009]
    vz_gold = [0.6796886263031019 0.0546987194786932 0.6544840742896139 0.2690581973421958 0.6163993206531809; 0.8978697823907873 0.48799619979859743 0.3360350809417053 0.3756416071171593 0.696855253084969; 0.06042283791825087 0.006816545656897821 0.47343412206244173 0.5008910996855729 0.8637826121027783; 0.6520160335501194 0.729914088517108 0.7932874718005488 0.645300139186034 0.6917308325421467; 0.48297946063054586 0.6874946836308082 0.6655727302526888 0.5281794298687704 0.8180220983257649;;; 0.3429264423231425 0.17791638287647582 0.3529795698043975 0.07914617259601409 0.9276638393800479; 0.7312911285136041 1.3618020465994347 0.7892033040935716 1.2397163826101079 0.406046995073139; 0.03619962176802749 0.3197574281227316 0.6978576333740687 1.227303661907506 0.16418964646660306; 0.5226476466668541 0.11596909178483494 1.3688997910883227 0.1821839044227608 0.33645181765921395; 0.4710300473568916 0.3757855789673571 0.4246863566184772 0.5856856488517632 0.7875463861707878;;; 0.21019034222004251 0.4221542818381374 0.9434792311999551 0.9710920433094289 0.4720655280941709; 0.4143686777159752 1.1422083273073314 0.772072200141552 0.18957917134896568 0.11697005242898784; 0.9475559631990929 0.8670986558700294 0.2610394308336335 0.6014299129354451 0.5570055497649916; 0.08045722999366534 0.2268417256730153 0.06027870994316342 0.019499095414478262 0.4310361638095087; 0.3549665240710188 0.7539543722435816 0.8875422548807369 0.07752759288011224 0.5320968388689262;;; 0.2240840381581508 0.09920036335177973 0.011833805913921691 0.2412123092940771 0.6464272282256478; 0.17933789106888387 0.5714155096523359 0.9874309072731045 0.5116858701980563 0.2716035773417844; 0.47933345603860933 0.7366885045151786 0.635749936208907 0.2733472941935022 0.6529240592998058; 0.1237753154904947 0.8628965647726538 0.9655443458194614 1.0850967851537903 0.8907286921339608; 0.5758763609413203 0.9867993525333909 0.8395654337107887 0.49096563517873404 0.579112968837231;;; 0.636704267643127 0.7115288507739786 0.11958883078305438 0.004867374248304079 0.8820252138292536; 0.21041439401592854 0.5682697267131694 0.18452813762216336 0.6222005435045196 0.7247691614476025; 0.719541669903262 0.5167990381072305 0.07471754218634452 0.30236026453135234 0.8089542968750867; 0.6256510436014113 0.740074019506953 0.6355031487310929 0.18365527593174946 0.19498401848779312; 0.6394670130068828 0.9933671763203821 0.8218024998081985 0.6734579451764313 0.3673290306983388]

    # apply all 3D kernels
    @parallel (1:size(ux_init, 1), 1:size(ux_init, 2), 1:size(ux_init, 3)) update_vecv_nabla2!(ux_init, uy_init, uz_init, vx_init, vy_init, vz_init, dt, _dx2, _dy2, _dz2, alpha)
    @parallel (1:size(ux_init, 1)-2, 1:size(ux_init, 2)-2, 1:size(ux_init, 3)-2) update_vecv_sigma!(ux_init, uy_init, uz_init, vx_init, vy_init, vz_init, dt, beta, gamma)
    @parallel (1:size(ux_init, 1), 1:size(ux_init, 2), 1:size(ux_init, 3)) update_vecv_varepsilon!(ux_init, uy_init, uz_init, vx_init, vy_init, vz_init, dt, _dx_2, _dy_2, _dz_2, alpha, etax, etay, etaz)
    @parallel (1:size(ux_init, 1)-2, 1:size(ux_init, 2)-2, 1:size(ux_init, 3)-2) update_vecu!(ux_init, uy_init, uz_init, vx_init, vy_init, vz_init, dt)

    # refernce test with gold solution
    @test all(ux_gold .≈ Array(ux_init))
    @test all(uy_gold .≈ Array(uy_init))
    @test all(uz_gold .≈ Array(uz_init))
    @test all(vx_gold .≈ Array(vx_init))
    @test all(vy_gold .≈ Array(vy_init))
    @test all(vz_gold .≈ Array(vz_init))

    # unit tests 
    # test that the boundaries stayed constant from in the previous test
    @test all(ux_boundary[1,:,:] .≈ Array(ux_init[1,:,:]))
    @test all(ux_boundary[end,:,:] .≈ Array(ux_init[end,:,:]))
    @test all(ux_boundary[:,1,:] .≈ Array(ux_init[:,1,:]))
    @test all(ux_boundary[:,end,:] .≈ Array(ux_init[:,end,:]))
    @test all(ux_boundary[:,:,1] .≈ Array(ux_init[:,:,1]))
    @test all(ux_boundary[:,:,end] .≈ Array(ux_init[:,:,end]))

    @test all(uy_boundary[1,:,:] .≈ Array(uy_init[1,:,:]))
    @test all(uy_boundary[end,:,:] .≈ Array(uy_init[end,:,:]))
    @test all(uy_boundary[:,1,:] .≈ Array(uy_init[:,1,:]))
    @test all(uy_boundary[:,end,:] .≈ Array(uy_init[:,end,:]))
    @test all(uy_boundary[:,:,1] .≈ Array(uy_init[:,:,1]))
    @test all(uy_boundary[:,:,end] .≈ Array(uy_init[:,:,end]))

    @test all(uz_boundary[1,:,:] .≈ Array(uz_init[1,:,:]))
    @test all(uz_boundary[end,:,:] .≈ Array(uz_init[end,:,:]))
    @test all(uz_boundary[:,1,:] .≈ Array(uz_init[:,1,:]))
    @test all(uz_boundary[:,end,:] .≈ Array(uz_init[:,end,:]))
    @test all(uz_boundary[:,:,1] .≈ Array(uz_init[:,:,1]))
    @test all(uz_boundary[:,:,end] .≈ Array(uz_init[:,:,end]))

    @test all(vx_boundary[1,:,:] .≈ Array(vx_init[1,:,:]))
    @test all(vx_boundary[end,:,:] .≈ Array(vx_init[end,:,:]))
    @test all(vx_boundary[:,1,:] .≈ Array(vx_init[:,1,:]))
    @test all(vx_boundary[:,end,:] .≈ Array(vx_init[:,end,:]))
    @test all(vx_boundary[:,:,1] .≈ Array(vx_init[:,:,1]))
    @test all(vx_boundary[:,:,end] .≈ Array(vx_init[:,:,end]))

    @test all(vy_boundary[1,:,:] .≈ Array(vy_init[1,:,:]))
    @test all(vy_boundary[end,:,:] .≈ Array(vy_init[end,:,:]))
    @test all(vy_boundary[:,1,:] .≈ Array(vy_init[:,1,:]))
    @test all(vy_boundary[:,end,:] .≈ Array(vy_init[:,end,:]))
    @test all(vy_boundary[:,:,1] .≈ Array(vy_init[:,:,1]))
    @test all(vy_boundary[:,:,end] .≈ Array(vy_init[:,:,end]))

    @test all(vz_boundary[1,:,:] .≈ Array(vz_init[1,:,:]))
    @test all(vz_boundary[end,:,:] .≈ Array(vz_init[end,:,:]))
    @test all(vz_boundary[:,1,:] .≈ Array(vz_init[:,1,:]))
    @test all(vz_boundary[:,end,:] .≈ Array(vz_init[:,end,:]))
    @test all(vz_boundary[:,:,1] .≈ Array(vz_init[:,:,1]))
    @test all(vz_boundary[:,:,end] .≈ Array(vz_init[:,:,end]))

end

@testset "wave3DnonlinearChi3" begin
    include("../src/wave3DnonlinearChi3.jl")

    # refernce test for chi3 nonlinearity
    # init random start values
    ux_init = Data.Array([0.06416405778491785 0.24760016126448614 0.36491790962768056 0.7881112047377304 0.5660124531243144; 0.7283825621028936 0.26682363575137946 0.8581603259234105 0.6881926964790105 0.5611190579880438; 0.04801168433634384 0.8785553223854713 0.2371738589724095 0.5025597792592889 0.22969148577029752; 0.6223825846367566 0.15675150382618364 0.5041921475100427 0.9725550951113372 0.016881467239792336; 0.42677563886297953 0.3125000986718329 0.5203438546959266 0.004479819721892375 0.5200061787421203;;; 0.49237830304627805 0.7777053093260963 0.7414366358657908 0.5545654110924016 0.3807431294071789; 0.7928295654439893 0.38256896227696036 0.11501099037248064 0.41012907458882963 0.07694424473953954; 0.7463323911782378 0.37513468690571294 0.05624464053441891 0.635612264990048 0.5979329654224296; 0.6879874125918056 0.41636105111083355 0.47417041425202533 0.8046878152623848 0.9440519699973703; 0.7007811457219205 0.5088018535589868 0.4379982535374978 0.20437655953276146 0.7466721541313489;;; 0.30531358473109327 0.7013291767712979 0.3975367921793551 0.8298211190779882 0.32744267956598305; 0.5020503188252853 0.7987759135759951 0.7141413644857151 0.8468483979433045 0.21830798978965638; 0.5507991422924946 0.6222062882443933 0.0361582897989412 0.40500127184966006 0.09479092199421824; 0.6585255167008296 0.10149669379526272 0.293500027671039 0.6688732589880124 0.3086813943978791; 0.7424911574738756 0.952983864482965 0.6099416389883122 0.994922501497207 0.1022551932770086;;; 0.23738159706951034 0.9428027854318032 0.5948935449642858 0.5506460841171287 0.31274467267516337; 0.357321537151154 0.9518185279999966 0.3850510983394958 0.09989880778025773 0.26689284173473826; 0.5635621620635549 0.3784976280319511 0.23873539410094013 0.33385173038279525 0.7447543549463688; 0.5328776875937442 0.2811439182237534 0.9774627488438785 0.2554709426939257 0.1763848572023362; 0.46484566206777334 0.8900736905280435 0.5167671510069066 0.7631323573820948 0.06816098988472652;;; 0.5817054561096072 0.5346156831743639 0.14202764562703918 0.11323797084101983 0.24930919050777522; 0.48656715115201965 0.5805645497215174 0.49852961049827893 0.4069419743607151 0.7528941881857931; 0.959053449438907 0.872673533518919 0.7397025827396143 0.2648168331702796 0.24541236262246335; 0.9429595595884126 0.03163589936611366 0.6333760970290611 0.5434557695572462 0.6382751245932087; 0.5823082823616509 0.6801524738336128 0.07700058809311594 0.042112981012161654 0.5544599438679392])
    uy_init = Data.Array([0.7517513463468547 0.945927896108825 0.6631365163887885 0.7961713370650066 0.34630210345025614; 0.2509588492709438 0.9767360756852831 0.7819352982949188 0.8108335317102338 0.28350727582579016; 0.11223067529578068 0.5204644643719355 0.43406789376203647 0.22436336754802655 0.9245545503975359; 0.3890939870746116 0.7472500627420046 0.4218294179437644 0.010630486348175539 0.6626557690296158; 0.06562893256384328 0.3083817910405656 0.394760867180843 0.4440142752056304 0.9012656273318533;;; 0.8197551566266211 0.10446693415318276 0.40875858404337595 0.062292040511835456 0.5269049011190793; 0.17954864073136012 0.29451809309017407 0.14545258307601194 0.13681613515142232 0.3607815188550433; 0.6203530923140204 0.17539942246347362 0.5577883844804016 0.1946400876331087 0.25270496551031996; 0.12525695406183412 0.17214664200850904 0.7510868608745008 0.325527140081179 0.34191333552835335; 0.7182279345298083 0.08739379660294289 0.4438545944319616 0.2611010620963867 0.9394218548120813;;; 0.4278903802328846 0.6592534213726742 0.512624833278918 0.2546373821228406 0.7793265892136362; 0.3125022257170923 0.6569469434643721 0.889972305466809 0.007819661508237874 0.5556587150404219; 0.6162464904832499 0.8163195276535252 0.901346236778346 0.5367618875110592 0.032294998460331015; 0.8984673692477015 0.4172296794974323 0.8012235194773282 0.03824186314543898 0.803270309917268; 0.5388753895904352 0.23476081123101045 0.16045989656263238 0.7943371195368657 0.7230259709761316;;; 0.18262080973776507 0.420311829052491 0.4796063259317973 0.3777120309998395 0.2414920550920594; 0.24567063243460052 0.8229692534493727 0.9242273392025383 0.9402914167718657 0.643286721933017; 0.9549414474377942 0.06639045664185661 0.9176073958603249 0.1005934611415995 0.8205154215476866; 0.10040806218698817 0.19041438612654515 0.5390101152335934 0.29662570416082257 0.2846796275659208; 0.6307345879127231 0.32821878066079724 0.6252000408323456 0.9080433457221363 0.8991482236223322;;; 0.007031109272959246 0.6974644911312556 0.16623107130194248 0.27851972375325773 0.8414974360028132; 0.3369577075165131 0.16657819781091776 0.7265172872294077 0.8310908166356671 0.9185982574179106; 0.8622377651809227 0.7231434617936758 0.268757595867103 0.24028280018401738 0.6285068395601697; 0.6839935644526192 0.9584476402254553 0.6336006569527275 0.7728099686556122 0.5926475741634855; 0.4778761373378413 0.12977359724019344 0.8965461599691117 0.9171873350250137 0.21782042988962957])
    uz_init = Data.Array([0.203790145612608 0.921616747063175 0.023099155238558655 0.3437574949289147 0.6133052616716085; 0.3934963124413795 0.4380052203088167 0.4966613104087766 0.35412149428296535 0.9996698660791794; 0.8380200257275967 0.20135676438031747 0.010804948960864813 0.37974877805521157 0.06667098420239703; 0.03885659818296727 0.9624693907211691 0.8574291677993062 0.962860832300604 0.044379549001687724; 0.456660761348913 0.6316626342087202 0.04289685193816828 0.32145054004123264 0.38523082229106154;;; 0.23378195008326774 0.9296852581983411 0.33710287693184604 0.245742971564348 0.4307751962360201; 0.7873477956713086 0.6125662698357708 0.8506009549465212 0.06463414610214469 0.4101218937577601; 0.03743845468470486 0.467772651399311 0.7093041239537631 0.23817086113452923 0.6361501287194442; 0.8854025662976327 0.09631421189065448 0.7771759390226608 0.6562982915718704 0.5261742194191815; 0.6819286031854851 0.5387921268209498 0.9030649355274117 0.24653887630444415 0.894952750822887;;; 0.2280417277382274 0.59770162348274 0.13506094282679648 0.07023409118515977 0.6312883833801326; 0.00487370143803556 0.39323247549962914 0.13630780850010993 0.8826030363699618 0.4802422132844606; 0.18873244041315762 0.2581025484963252 0.7054503471125195 0.369288122773217 0.051756850858082126; 0.079624440178516 0.16523591854216813 0.44513564091603874 0.5473487429112659 0.6759222571643941; 0.25143030172547287 0.48681405239687936 0.843183932706196 0.4781221556495634 0.29896198232985416;;; 0.680330866898826 0.15845774051171402 0.2353287868647419 0.46250666838106436 0.9702604448588051; 0.9303548088752467 0.5932171093741679 0.5792689398830181 0.11985346518337936 0.028473333311919036; 0.009234556015967565 0.6344755660712468 0.24067705074982637 0.7127955152527604 0.8070985217980259; 0.5424884292175267 0.8324926873217534 0.40071350305223463 0.8578208091867587 0.7270374728728073; 0.6718051850827235 0.11954275687897098 0.048082561492946874 0.7590249307832292 0.6194371790689345;;; 0.7708243795763139 0.8014155995841953 0.058002484642140084 0.1882270452879542 0.23891477499058567; 0.023504921352116903 0.3418683041576258 0.24632976544038 0.4468508735515204 0.04280435702985563; 0.4431063793120362 0.6791140242199096 0.8374373707872518 0.44999444941331657 0.5729480213356086; 0.8929138564490979 0.47148571261089256 0.514783722752239 0.7100656500772773 0.04050728368218437; 0.8201122734267342 0.27832201978302096 0.20089375210281735 0.748412203035826 0.8115820363466881])
    vx_init = Data.Array([0.13576924452340033 0.45977120240429414 0.2913640562905633 0.837696393192376 0.6924993976438596; 0.3707211078946224 0.593475227872252 0.9033106973983509 0.36592863190941394 0.9021053083917392; 0.7239987710907816 0.6004883255006747 0.5152011534524102 0.6225366762482474 0.3168308988118089; 0.9004385853656172 0.4684522867837906 0.27055608968708666 0.5587114395853038 0.47310932857445764; 0.2562108787500269 0.028593077696345448 0.06077493951555635 0.27994020783789697 0.5039360947962053;;; 0.1184685019465197 0.6325310797022136 0.7369933872028099 0.9051859527425952 0.43413766060685854; 0.6233645406215765 0.28839087580112044 0.6458644120762087 0.3274252959493159 0.9877344678813051; 0.5594180606310173 0.6066959807645077 0.8987326804334177 0.78679892738228 0.5799429297659547; 0.8524039060604814 0.22095467864342078 0.22014522580425322 0.07699921785840069 0.6974915856603932; 0.912083822668242 0.7930789829854393 0.319597844022139 0.8670999977172114 0.2509058664836571;;; 0.39433250531874653 0.4772718841294381 0.7129192263003913 0.7433603812037715 0.24223763437625745; 0.7031162028221837 0.5427333685295759 0.41470817742534594 0.5141014405015479 0.2835707381308141; 0.5166495246123873 0.23851398259099044 0.5618420796291055 0.8803254758233373 0.11684203217665734; 0.7980494822608255 0.4166463337260231 0.06581834522168695 0.27225831662397026 0.23714896000827734; 0.8947021090935964 0.47311875672011816 0.37432703179307936 0.18501285356032193 0.7496593678321193;;; 0.025778710943046956 0.07685227491818636 0.14633485238345512 0.6421324359531133 0.035771262568981554; 0.24526555662727434 0.3130001253661824 0.6431293493072036 0.44638395809594145 0.08226017826672882; 0.6641241474337302 0.38765958409928836 0.46318209029874324 0.6277134953744101 0.3639785864506335; 0.7846101634470782 0.22495974187002055 0.438421956558563 0.9682256178234662 0.8721583224993468; 0.32176243014557104 0.12054901350168978 0.14530539338900617 0.7082962323357171 0.4520306134837938;;; 0.6197724358006799 0.21396993013753762 0.7158379710278252 0.8556788705627685 0.14780669133373636; 0.43808763359172365 0.5877261366023069 0.0795376889404944 0.843679301273059 0.16881572792744337; 0.5949438367769607 0.09145248081066648 0.4681311022879475 0.7059595459001609 0.9943309427484337; 0.34456813014856236 0.74099197030078 0.9389053014872544 0.12154337045422059 0.5422896200725732; 0.25036989898239415 0.2877315863034081 0.8022656863465558 0.8564142864717218 0.24822741355288203])
    vy_init = Data.Array([0.06305640207927066 0.3937265052439286 0.790767395715794 0.23373819824037811 0.9386673459543713; 0.8554748009989912 0.966810823670426 0.8562612160585285 0.9156337110518665 0.535539505604868; 0.8799066703747018 0.867207847025881 0.18229731783919445 0.6180943095251185 0.5815054733868158; 0.8894076425440864 0.0762704355874727 0.1919854207223558 0.37820323209433526 0.4479596131956647; 0.16543038013017852 0.8211938084103854 0.8545090935239854 0.505733287812237 0.18315253146148658;;; 0.8167420322195307 0.24900473364727715 0.5042258499903549 0.21288497699238373 0.2308279249798285; 0.6538259187605515 0.35225729058097344 0.38602777658098375 0.019686692174168297 0.5217431762503106; 0.7057980041964336 0.9082317948244928 0.17657044340674544 0.9357536201926614 0.0013169363269219803; 0.7518342194553059 0.4214891133700146 0.30481459322987603 0.16893004863690342 0.7227970295492021; 0.49795081371554506 0.15346261348176604 0.9873372060486477 0.2971310396050204 0.3545148948039408;;; 0.2898843339543199 0.9257821545871079 0.315512632022392 0.08943102074773202 0.8246627319814916; 0.4223957272390104 0.7632269734395485 0.37255178745796236 0.16082366838332662 0.2615009483273605; 0.4488891557320446 0.9360267300888616 0.4548648414288401 0.6993302505366364 0.8457415494777308; 0.6638908916399919 0.8713424555035402 0.3831866788274685 0.39968283158974405 0.5749184617928796; 0.07798846152777783 0.9731912724281412 0.17032390586137724 0.05145689127548725 0.4309513625968212;;; 0.7036851683344755 0.32391529682179276 0.07049627802266634 0.508872746036095 0.8241338718106261; 0.7197802532843559 0.2663463742300137 0.47367034287801 0.5659397963082188 0.23606909692023437; 0.6161127543447372 0.3958780199902754 0.30093827356466485 0.9923890101177398 0.6266545178524408; 0.5820829321838283 0.31257930020799696 0.9446741048989186 0.8300576884872707 0.11120756342277827; 0.5303984288423008 0.5387407308980946 0.7345683951466652 0.8078363334651198 0.8824992406529918;;; 0.16228947484989698 0.5901472054084315 0.1361519602236183 0.9995695432856658 0.3250407077811194; 0.6500034299444318 0.34488920347392527 0.33994305678573444 0.09714423514795933 0.8084244447978433; 0.3564823753615284 0.31341943622826063 0.6932249545391121 0.5941929089381263 0.5300365283140627; 0.8064192063745842 0.5417177955721331 0.9929059298725404 0.2636613644250987 0.1247356597559105; 0.028539590375629365 0.9992612568909075 0.87877902603646 0.10441479611024596 0.7372984147560009])
    vz_init = Data.Array([0.6796886263031019 0.0546987194786932 0.6544840742896139 0.2690581973421958 0.6163993206531809; 0.8978697823907873 0.48799619979859743 0.3360350809417053 0.3756416071171593 0.696855253084969; 0.06042283791825087 0.006816545656897821 0.47343412206244173 0.5008910996855729 0.8637826121027783; 0.6520160335501194 0.729914088517108 0.7932874718005488 0.645300139186034 0.6917308325421467; 0.48297946063054586 0.6874946836308082 0.6655727302526888 0.5281794298687704 0.8180220983257649;;; 0.3429264423231425 0.17791638287647582 0.3529795698043975 0.07914617259601409 0.9276638393800479; 0.7312911285136041 0.9377960716929602 0.6758825924624461 0.7020153486520572 0.406046995073139; 0.03619962176802749 0.08486151323601854 0.3407366694192667 0.6018174559223972 0.16418964646660306; 0.5226476466668541 0.06132505447030179 0.7666211269183055 0.14127418052790341 0.33645181765921395; 0.4710300473568916 0.3757855789673571 0.4246863566184772 0.5856856488517632 0.7875463861707878;;; 0.21019034222004251 0.4221542818381374 0.9434792311999551 0.9710920433094289 0.4720655280941709; 0.4143686777159752 0.6396352503511326 0.40072295183968576 0.18976181461539077 0.11697005242898784; 0.9475559631990929 0.5237293705890336 0.08356035011673446 0.3334303074832925 0.5570055497649916; 0.08045722999366534 0.13698568806093214 0.1370374572346592 0.03397481975615502 0.4310361638095087; 0.3549665240710188 0.7539543722435816 0.8875422548807369 0.07752759288011224 0.5320968388689262;;; 0.2240840381581508 0.09920036335177973 0.011833805913921691 0.2412123092940771 0.6464272282256478; 0.17933789106888387 0.4650586941873651 0.8065645073938796 0.06908970309134399 0.2716035773417844; 0.47933345603860933 0.5702447165259281 0.27090503626441953 0.07248212288312528 0.6529240592998058; 0.1237753154904947 0.5781754727101263 0.7786812905225562 0.6918105550087184 0.8907286921339608; 0.5758763609413203 0.9867993525333909 0.8395654337107887 0.49096563517873404 0.579112968837231;;; 0.636704267643127 0.7115288507739786 0.11958883078305438 0.004867374248304079 0.8820252138292536; 0.21041439401592854 0.5682697267131694 0.18452813762216336 0.6222005435045196 0.7247691614476025; 0.719541669903262 0.5167990381072305 0.07471754218634452 0.30236026453135234 0.8089542968750867; 0.6256510436014113 0.740074019506953 0.6355031487310929 0.18365527593174946 0.19498401848779312; 0.6394670130068828 0.9933671763203821 0.8218024998081985 0.6734579451764313 0.3673290306983388])

    # for boundary check
    ux_boundary = copy(Array(ux_init))
    uy_boundary = copy(Array(uy_init))
    uz_boundary = copy(Array(uz_init))
    vx_boundary = copy(Array(vx_init))
    vy_boundary = copy(Array(vy_init))
    vz_boundary = copy(Array(vz_init))

    # init random number
    dt      = 0.4946809748957348
    _dx     = 0.5953973770646261
    _dy     = 0.14123687561569254
    _dz     = 0.7648859006178157
    _dx_2   = 0.16826534995454057
    _dy_2   = 0.8389433089026066
    _dz_2   = 0.7117334786051834
    alpha   = Data.Array([0.3681307633959595 0.7740236976357958 0.9647040160728227 0.6961308501036569 0.19130089988244625; 0.3595623549429635 0.536466177239351 0.9953943443907606 0.30109620673757465 0.06566750671430732; 0.8426685926810429 0.03560821208626408 0.14152157732423432 0.7130483104114443 0.9163867125864724; 0.7001548098593874 0.9264805032119213 0.15642962537360927 0.4207838897670143 0.13717260747001792; 0.7329268154244377 0.2562623091928101 0.8969398288588866 0.8572003556073791 0.937936680802613;;; 0.3612317882410303 0.68866303883854 0.3992034626866331 0.967278182316477 0.36005659977061455; 0.6414187529852606 0.4560841839648436 0.28356993233271965 0.3108245873230686 0.00029818149260085747; 0.7303425219543033 0.5118848345738916 0.05730382658938027 0.36058025204770316 0.08656090371325542; 0.3382040850972847 0.29739434950281685 0.27728145601277565 0.014113080725016935 0.6894270496898302; 0.2514967203369821 0.7025345408855631 0.2257641358671516 0.7306949993249047 0.9033916028137433;;; 0.933941407499051 0.7580166706884219 0.31082106403033083 0.3897186331167739 0.8328032807753096; 0.9726141170056595 0.9572176718847087 0.9808613703411527 0.3080810478098782 0.7786903436010618; 0.11664082499862138 0.9076590073327558 0.9622201098731716 0.6982059979337685 0.5811044479478684; 0.06736507995422558 0.18070383046812144 0.6378199911044172 0.5036669634511421 0.07874274797686209; 0.2679134966032273 0.16264061583385936 0.6586156427516207 0.8743095578716215 0.7724807961323904;;; 0.6628984385997174 0.8639327029499407 0.5062916777817867 0.47845101648535715 0.6273038349527522; 0.0356635918486542 0.027366110023509194 0.5874581907611609 0.34913281353353454 0.7007277788369624; 0.6090117360453203 0.0020220039445810745 0.6429018055092424 0.6496122484744203 0.4090731818715825; 0.5227274021319759 0.6295291890920008 0.5079246071048424 0.6831287699409169 0.3699873619729821; 0.6620904360382535 0.07229540604890183 0.22144655496393495 0.32580362444539124 0.24967066577424124;;; 0.6115194536201339 0.9281629362779181 0.09601862509491466 0.42719557033820676 0.7904337938121728; 0.4379175360195543 0.32705003509191466 0.2062722113274731 0.8461872999400188 0.9613007205545037; 0.18404285610766824 0.3877299259309065 0.10203314259204499 0.47155673614472404 0.4492632534363421; 0.8549953819440748 0.9841675537474331 0.9978192023300564 0.5541743967471973 0.17323869696771976; 0.22908791713165466 0.8164637343807493 0.059891157889876645 0.9434462658757831 0.9919798550176396])
    delta   = Data.Array([0.27920313380607475 0.34381985834694406 0.680657592075043 0.12215212183116686 0.08139204924721188; 0.057064490190110506 0.35035736971795717 0.46231847047069885 0.327852934542215 0.5872299826268881; 0.8018675076288927 0.15959111851561458 0.2836495548010668 0.8989709335124015 0.33466378789539997; 0.39169461544131023 0.6031978267977746 0.7168055787545992 0.01003152076898961 0.58088851125804; 0.7494098939511046 0.8535211104912681 0.5595744546817746 0.12889076138014655 0.5422496527477207;;; 0.27932347210604924 0.002772173210834228 0.5641587665340371 0.755401333287037 0.11135273361934961; 0.6701834287137032 0.2451461831221713 0.6311677263352291 0.9400227164710678 0.7877165296865574; 0.5796729383925745 0.8202935551145866 0.46114430511090077 0.660436457286315 0.9834684849350909; 0.11085402459669602 0.8216978898120799 0.7098911129388187 0.5557505135337174 0.12030650763280282; 0.07637842597597455 0.0925917990104721 0.2591434811108465 0.712951959715134 0.6466022587679154;;; 0.19311165739453184 0.3889082880239775 0.7076044970991971 0.2939483078782731 0.825686760647065; 0.010527596669833827 0.6061198185554582 0.024671423724489827 0.8924508181160429 0.28800066617388886; 0.9819774608180609 0.618326962444333 0.7497664400275078 0.003049401041144928 0.8904068693382372; 0.15533691058810428 0.2737780822133421 0.06364390648433338 0.1679333085294853 0.12236066133492685; 0.3617133534810394 0.13625648242437405 0.008913883253561461 0.03430637497215705 0.8472629791446781;;; 0.09980596927578311 0.39924568364668334 0.2695467911959224 0.49679968094850036 0.42710136969282864; 0.40946135525467364 0.8802199491886028 0.00458316295445127 0.1257543916167312 0.3832282876984997; 0.34348709887964024 0.8175336378999053 0.2992726785143699 0.8419367834360278 0.6035831927341422; 0.4267173831897343 0.2656320232700111 0.8789451991928576 0.9046236660412956 0.07935884367411261; 0.7270102287841055 0.08745491315312648 0.2998315289723653 0.8740601312364834 0.5594609373676735;;; 0.9446384802880564 0.21084593022079234 0.3057450337861861 0.5132307320434447 0.19049403085645478; 0.3506496966884308 0.23764681326539616 0.48413637568081425 0.5183937123028979 0.005306794087591937; 0.4104503680041729 0.9514815891152346 0.4453998648102042 0.19894091600078723 0.9327809742748083; 0.3641726889726977 0.7970302726247557 0.03486725731107598 0.680996158388071 0.05660931602649999; 0.4714793667249553 0.003581433238453613 0.7769707313367011 0.10418071988387145 0.42443391736955594])
    omega   = Data.Array([0.9120421202446477 0.9330599906734403 0.0982589923766215 0.9280823935570734 0.3582675262221743; 0.7198822455772719 0.966683505858476 0.7426515461873848 0.8776392671943222 0.31916638291042043; 0.1910873229314224 0.1007595197084602 0.8049602388853802 0.20612785909936304 0.015516386793612558; 0.041452357486683744 0.7104721631314285 0.16387624136896817 0.34702078820494975 0.4157653594131858; 0.7352697073576557 0.21612966426104552 0.4017586044450906 0.09367029067444277 0.6705820757887633;;; 0.33956687633841043 0.3859730441817155 0.44493674467803757 0.516928614978814 0.0009581963384432957; 0.032575857933433205 0.1524832171795807 0.4421058769799291 0.16025002482162176 0.3849990387737414; 0.27785331560036497 0.4032380918017795 0.2708538131459979 0.6824061946891253 0.7216319358197812; 0.5197423758296913 0.8110940131962672 0.7734667474676941 0.927522069901762 0.13742113379437637; 0.5057669425205246 0.8559678546625309 0.7187131218078424 0.2217727117601589 0.21618965479798047;;; 0.4616211359059783 0.4107767122190893 0.042690617572268774 0.9003221882986165 0.38932786718572343; 0.967747653740742 0.4940264395766616 0.632079459603242 0.5570122335746202 0.7447420381705177; 0.7182892140834485 0.4975121842298563 0.988854320287435 0.46252077344239706 0.07619537889151051; 0.19504072994000432 0.6754561256138081 0.7091437961401051 0.6964295280772123 0.467550659079114; 0.8022791380953674 0.5270865867361403 0.4827030151287386 0.9123341258351638 0.9144462614408806;;; 0.355660594673881 0.3803689051673603 0.2689715348231305 0.23881604300275772 0.9344920362924644; 0.5466942864375227 0.6550808954983239 0.16889222762073586 0.2570413272691042 0.9826874531258881; 0.521888065768052 0.7932884987852531 0.13509657284893462 0.40854530723497484 0.4015892714030189; 0.14236923102397292 0.8577761907360884 0.0796565394761668 0.1082500504126449 0.6261047756071282; 0.40526795109585445 0.7357539645342901 0.748859036524862 0.7685182182148628 0.2210185301913592;;; 0.5729398899991709 0.5350298230422913 0.65443606149414 0.14780916209049588 0.31702565838732744; 0.8520353574568462 0.7905475085084713 0.5889728675851236 0.12844599399311907 0.04247892481166882; 0.8924417620847054 0.8841887152814294 0.99132801713835 0.568378244612683 0.3691403961913554; 0.1853952164742817 0.039465708989494086 0.5515342580888227 0.723974234473422 0.9422991126068821; 0.28624170110608194 0.8966145149506842 0.7660320604303892 0.18427696235615432 0.8055463681815956])
    
    # init gold solution
    ux_gold = [0.06416405778491785 0.24760016126448614 0.36491790962768056 0.7881112047377304 0.5660124531243144; 0.7283825621028936 0.26682363575137946 0.8581603259234105 0.6881926964790105 0.5611190579880438; 0.04801168433634384 0.8785553223854713 0.2371738589724095 0.5025597792592889 0.22969148577029752; 0.6223825846367566 0.15675150382618364 0.5041921475100427 0.9725550951113372 0.016881467239792336; 0.42677563886297953 0.3125000986718329 0.5203438546959266 0.004479819721892375 0.5200061787421203;;; 0.49237830304627805 0.7777053093260963 0.7414366358657908 0.5545654110924016 0.3807431294071789; 0.7928295654439893 0.38256896227696036 0.11501099037248064 0.41012907458882963 0.07694424473953954; 0.7463323911782378 0.37513468690571294 0.05624464053441891 0.635612264990048 0.5979329654224296; 0.6879874125918056 0.41636105111083355 0.47417041425202533 0.8046878152623848 0.9440519699973703; 0.7007811457219205 0.5088018535589868 0.4379982535374978 0.20437655953276146 0.7466721541313489;;; 0.30531358473109327 0.7013291767712979 0.3975367921793551 0.8298211190779882 0.32744267956598305; 0.5020503188252853 0.7987759135759951 0.7141413644857151 0.8468483979433045 0.21830798978965638; 0.5507991422924946 0.6222062882443933 0.0361582897989412 0.40500127184966006 0.09479092199421824; 0.6585255167008296 0.10149669379526272 0.293500027671039 0.6688732589880124 0.3086813943978791; 0.7424911574738756 0.952983864482965 0.6099416389883122 0.994922501497207 0.1022551932770086;;; 0.23738159706951034 0.9428027854318032 0.5948935449642858 0.5506460841171287 0.31274467267516337; 0.357321537151154 0.9518185279999966 0.3850510983394958 0.09989880778025773 0.26689284173473826; 0.5635621620635549 0.3784976280319511 0.23873539410094013 0.33385173038279525 0.7447543549463688; 0.5328776875937442 0.2811439182237534 0.9774627488438785 0.2554709426939257 0.1763848572023362; 0.46484566206777334 0.8900736905280435 0.5167671510069066 0.7631323573820948 0.06816098988472652;;; 0.5817054561096072 0.5346156831743639 0.14202764562703918 0.11323797084101983 0.24930919050777522; 0.48656715115201965 0.5805645497215174 0.49852961049827893 0.4069419743607151 0.7528941881857931; 0.959053449438907 0.872673533518919 0.7397025827396143 0.2648168331702796 0.24541236262246335; 0.9429595595884126 0.03163589936611366 0.6333760970290611 0.5434557695572462 0.6382751245932087; 0.5823082823616509 0.6801524738336128 0.07700058809311594 0.042112981012161654 0.5544599438679392]
    uy_gold = [0.7517513463468547 0.945927896108825 0.6631365163887885 0.7961713370650066 0.34630210345025614; 0.2509588492709438 0.9767360756852831 0.7819352982949188 0.8108335317102338 0.28350727582579016; 0.11223067529578068 0.5204644643719355 0.43406789376203647 0.22436336754802655 0.9245545503975359; 0.3890939870746116 0.7472500627420046 0.4218294179437644 0.010630486348175539 0.6626557690296158; 0.06562893256384328 0.3083817910405656 0.394760867180843 0.4440142752056304 0.9012656273318533;;; 0.8197551566266211 0.10446693415318276 0.40875858404337595 0.062292040511835456 0.5269049011190793; 0.17954864073136012 0.29451809309017407 0.14545258307601194 0.13681613515142232 0.3607815188550433; 0.6203530923140204 0.17539942246347362 0.5577883844804016 0.1946400876331087 0.25270496551031996; 0.12525695406183412 0.17214664200850904 0.7510868608745008 0.325527140081179 0.34191333552835335; 0.7182279345298083 0.08739379660294289 0.4438545944319616 0.2611010620963867 0.9394218548120813;;; 0.4278903802328846 0.6592534213726742 0.512624833278918 0.2546373821228406 0.7793265892136362; 0.3125022257170923 0.6569469434643721 0.889972305466809 0.007819661508237874 0.5556587150404219; 0.6162464904832499 0.8163195276535252 0.901346236778346 0.5367618875110592 0.032294998460331015; 0.8984673692477015 0.4172296794974323 0.8012235194773282 0.03824186314543898 0.803270309917268; 0.5388753895904352 0.23476081123101045 0.16045989656263238 0.7943371195368657 0.7230259709761316;;; 0.18262080973776507 0.420311829052491 0.4796063259317973 0.3777120309998395 0.2414920550920594; 0.24567063243460052 0.8229692534493727 0.9242273392025383 0.9402914167718657 0.643286721933017; 0.9549414474377942 0.06639045664185661 0.9176073958603249 0.1005934611415995 0.8205154215476866; 0.10040806218698817 0.19041438612654515 0.5390101152335934 0.29662570416082257 0.2846796275659208; 0.6307345879127231 0.32821878066079724 0.6252000408323456 0.9080433457221363 0.8991482236223322;;; 0.007031109272959246 0.6974644911312556 0.16623107130194248 0.27851972375325773 0.8414974360028132; 0.3369577075165131 0.16657819781091776 0.7265172872294077 0.8310908166356671 0.9185982574179106; 0.8622377651809227 0.7231434617936758 0.268757595867103 0.24028280018401738 0.6285068395601697; 0.6839935644526192 0.9584476402254553 0.6336006569527275 0.7728099686556122 0.5926475741634855; 0.4778761373378413 0.12977359724019344 0.8965461599691117 0.9171873350250137 0.21782042988962957]
    uz_gold = [0.203790145612608 0.921616747063175 0.023099155238558655 0.3437574949289147 0.6133052616716085; 0.3934963124413795 0.4380052203088167 0.4966613104087766 0.35412149428296535 0.9996698660791794; 0.8380200257275967 0.20135676438031747 0.010804948960864813 0.37974877805521157 0.06667098420239703; 0.03885659818296727 0.9624693907211691 0.8574291677993062 0.962860832300604 0.044379549001687724; 0.456660761348913 0.6316626342087202 0.04289685193816828 0.32145054004123264 0.38523082229106154;;; 0.23378195008326774 0.9296852581983411 0.33710287693184604 0.245742971564348 0.4307751962360201; 0.7873477956713086 0.6125662698357708 0.8506009549465212 0.06463414610214469 0.4101218937577601; 0.03743845468470486 0.467772651399311 0.7093041239537631 0.23817086113452923 0.6361501287194442; 0.8854025662976327 0.09631421189065448 0.7771759390226608 0.6562982915718704 0.5261742194191815; 0.6819286031854851 0.5387921268209498 0.9030649355274117 0.24653887630444415 0.894952750822887;;; 0.2280417277382274 0.59770162348274 0.13506094282679648 0.07023409118515977 0.6312883833801326; 0.00487370143803556 0.39323247549962914 0.13630780850010993 0.8826030363699618 0.4802422132844606; 0.18873244041315762 0.2581025484963252 0.7054503471125195 0.369288122773217 0.051756850858082126; 0.079624440178516 0.16523591854216813 0.44513564091603874 0.5473487429112659 0.6759222571643941; 0.25143030172547287 0.48681405239687936 0.843183932706196 0.4781221556495634 0.29896198232985416;;; 0.680330866898826 0.15845774051171402 0.2353287868647419 0.46250666838106436 0.9702604448588051; 0.9303548088752467 0.5932171093741679 0.5792689398830181 0.11985346518337936 0.028473333311919036; 0.009234556015967565 0.6344755660712468 0.24067705074982637 0.7127955152527604 0.8070985217980259; 0.5424884292175267 0.8324926873217534 0.40071350305223463 0.8578208091867587 0.7270374728728073; 0.6718051850827235 0.11954275687897098 0.048082561492946874 0.7590249307832292 0.6194371790689345;;; 0.7708243795763139 0.8014155995841953 0.058002484642140084 0.1882270452879542 0.23891477499058567; 0.023504921352116903 0.3418683041576258 0.24632976544038 0.4468508735515204 0.04280435702985563; 0.4431063793120362 0.6791140242199096 0.8374373707872518 0.44999444941331657 0.5729480213356086; 0.8929138564490979 0.47148571261089256 0.514783722752239 0.7100656500772773 0.04050728368218437; 0.8201122734267342 0.27832201978302096 0.20089375210281735 0.748412203035826 0.8115820363466881] 
    vx_gold = [0.13576924452340033 0.45977120240429414 0.2913640562905633 0.837696393192376 0.6924993976438596; 0.3707211078946224 0.593475227872252 0.9033106973983509 0.36592863190941394 0.9021053083917392; 0.7239987710907816 0.6004883255006747 0.5152011534524102 0.6225366762482474 0.3168308988118089; 0.9004385853656172 0.4684522867837906 0.27055608968708666 0.5587114395853038 0.47310932857445764; 0.2562108787500269 0.028593077696345448 0.06077493951555635 0.27994020783789697 0.5039360947962053;;; 0.1184685019465197 0.6325310797022136 0.7369933872028099 0.9051859527425952 0.43413766060685854; 0.6233645406215765 0.2906358949221943 0.6555064282040487 0.3396761785118621 0.9877344678813051; 0.5594180606310173 0.6047204654031282 0.9020999866446633 0.7687086375405475 0.5799429297659547; 0.8524039060604814 0.22002099926448634 0.21098905901004655 0.07672543357876381 0.6974915856603932; 0.912083822668242 0.7930789829854393 0.319597844022139 0.8670999977172114 0.2509058664836571;;; 0.39433250531874653 0.4772718841294381 0.7129192263003913 0.7433603812037715 0.24223763437625745; 0.7031162028221837 0.5906321808457698 0.3649763812344225 0.5111654908272526 0.2835707381308141; 0.5166495246123873 0.20459897457100748 0.5607507796345811 0.9158353408718374 0.11684203217665734; 0.7980494822608255 0.4104383089439487 0.07649640642932728 0.27506287605371227 0.23714896000827734; 0.8947021090935964 0.47311875672011816 0.37432703179307936 0.18501285356032193 0.7496593678321193;;; 0.025778710943046956 0.07685227491818636 0.14633485238345512 0.6421324359531133 0.035771262568981554; 0.24526555662727434 0.31160641825246865 0.645888839811218 0.4562934453733769 0.08226017826672882; 0.6641241474337302 0.3877570864359498 0.4618370929457322 0.6456549695631896 0.3639785864506335; 0.7846101634470782 0.21507898496321698 0.4468068135490731 0.9594356642211804 0.8721583224993468; 0.32176243014557104 0.12054901350168978 0.14530539338900617 0.7082962323357171 0.4520306134837938;;; 0.6197724358006799 0.21396993013753762 0.7158379710278252 0.8556788705627685 0.14780669133373636; 0.43808763359172365 0.5877261366023069 0.0795376889404944 0.843679301273059 0.16881572792744337; 0.5949438367769607 0.09145248081066648 0.4681311022879475 0.7059595459001609 0.9943309427484337; 0.34456813014856236 0.74099197030078 0.9389053014872544 0.12154337045422059 0.5422896200725732; 0.25036989898239415 0.2877315863034081 0.8022656863465558 0.8564142864717218 0.24822741355288203]
    vy_gold = [0.06305640207927066 0.3937265052439286 0.790767395715794 0.23373819824037811 0.9386673459543713; 0.8554748009989912 0.966810823670426 0.8562612160585285 0.9156337110518665 0.535539505604868; 0.8799066703747018 0.867207847025881 0.18229731783919445 0.6180943095251185 0.5815054733868158; 0.8894076425440864 0.0762704355874727 0.1919854207223558 0.37820323209433526 0.4479596131956647; 0.16543038013017852 0.8211938084103854 0.8545090935239854 0.505733287812237 0.18315253146148658;;; 0.8167420322195307 0.24900473364727715 0.5042258499903549 0.21288497699238373 0.2308279249798285; 0.6538259187605515 0.32494647417682576 0.42202313734314884 0.04091157155806942 0.5217431762503106; 0.7057980041964336 0.976107752597865 0.17740361259825313 0.8915668336086289 0.0013169363269219803; 0.7518342194553059 0.4437184365713249 0.33752652780652687 0.16871565241214712 0.7227970295492021; 0.49795081371554506 0.15346261348176604 0.9873372060486477 0.2971310396050204 0.3545148948039408;;; 0.2898843339543199 0.9257821545871079 0.315512632022392 0.08943102074773202 0.8246627319814916; 0.4223957272390104 0.760858277264979 0.18043470168270614 0.16092481133319514 0.2615009483273605; 0.4488891557320446 0.9145079369736056 0.4135448418660869 0.8051818529819205 0.8457415494777308; 0.6638908916399919 0.8734319546788187 0.33472747639634604 0.41293227493185874 0.5749184617928796; 0.07798846152777783 0.9731912724281412 0.17032390586137724 0.05145689127548725 0.4309513625968212;;; 0.7036851683344755 0.32391529682179276 0.07049627802266634 0.508872746036095 0.8241338718106261; 0.7197802532843559 0.2654833515863538 0.5088740460743114 0.5606882008653435 0.23606909692023437; 0.6161127543447372 0.39581532390165874 0.1894455937800314 1.0139844369071171 0.6266545178524408; 0.5820829321838283 0.29500280037351284 1.033685621474535 0.8124732857414902 0.11120756342277827; 0.5303984288423008 0.5387407308980946 0.7345683951466652 0.8078363334651198 0.8824992406529918;;; 0.16228947484989698 0.5901472054084315 0.1361519602236183 0.9995695432856658 0.3250407077811194; 0.6500034299444318 0.34488920347392527 0.33994305678573444 0.09714423514795933 0.8084244447978433; 0.3564823753615284 0.31341943622826063 0.6932249545391121 0.5941929089381263 0.5300365283140627; 0.8064192063745842 0.5417177955721331 0.9929059298725404 0.2636613644250987 0.1247356597559105; 0.028539590375629365 0.9992612568909075 0.87877902603646 0.10441479611024596 0.7372984147560009]
    vz_gold = [0.6796886263031019 0.0546987194786932 0.6544840742896139 0.2690581973421958 0.6163993206531809; 0.8978697823907873 0.48799619979859743 0.3360350809417053 0.3756416071171593 0.696855253084969; 0.06042283791825087 0.006816545656897821 0.47343412206244173 0.5008910996855729 0.8637826121027783; 0.6520160335501194 0.729914088517108 0.7932874718005488 0.645300139186034 0.6917308325421467; 0.48297946063054586 0.6874946836308082 0.6655727302526888 0.5281794298687704 0.8180220983257649;;; 0.3429264423231425 0.17791638287647582 0.3529795698043975 0.07914617259601409 0.9276638393800479; 0.7312911285136041 0.9883659786037381 0.6951424789285083 0.7488711275698575 0.406046995073139; 0.03619962176802749 0.15946786462632057 0.3449398159042542 0.6067713013836867 0.16418964646660306; 0.5226476466668541 0.11595350152976328 0.7742087499587547 0.1411578551262475 0.33645181765921395; 0.4710300473568916 0.3757855789673571 0.4246863566184772 0.5856856488517632 0.7875463861707878;;; 0.21019034222004251 0.4221542818381374 0.9434792311999551 0.9710920433094289 0.4720655280941709; 0.4143686777159752 0.7528466377482175 0.4419999886444477 0.12496111596675726 0.11697005242898784; 0.9475559631990929 0.39046346566785073 -0.09287921029355198 0.4035957593442122 0.5570055497649916; 0.08045722999366534 0.11235897456634067 0.10275666306367709 0.14362289099577624 0.4310361638095087; 0.3549665240710188 0.7539543722435816 0.8875422548807369 0.07752759288011224 0.5320968388689262;;; 0.2240840381581508 0.09920036335177973 0.011833805913921691 0.2412123092940771 0.6464272282256478; 0.17933789106888387 0.4594315677014726 0.82779077397478 0.16879971740526545 0.2716035773417844; 0.47933345603860933 0.5696818175290983 0.4348197751610857 0.06701518143047161 0.6529240592998058; 0.1237753154904947 0.4439336284558041 0.7848098932217349 0.7756269215349485 0.8907286921339608; 0.5758763609413203 0.9867993525333909 0.8395654337107887 0.49096563517873404 0.579112968837231;;; 0.636704267643127 0.7115288507739786 0.11958883078305438 0.004867374248304079 0.8820252138292536; 0.21041439401592854 0.5682697267131694 0.18452813762216336 0.6222005435045196 0.7247691614476025; 0.719541669903262 0.5167990381072305 0.07471754218634452 0.30236026453135234 0.8089542968750867; 0.6256510436014113 0.740074019506953 0.6355031487310929 0.18365527593174946 0.19498401848779312; 0.6394670130068828 0.9933671763203821 0.8218024998081985 0.6734579451764313 0.3673290306983388]

    # apply the kernel to the random data
    @parallel (1:size(ux_init, 1), 1:size(ux_init, 2), 1:size(ux_init, 3)) update_vecv_chi3!(ux_init, uy_init, uz_init, vx_init, vy_init, vz_init, dt, _dx, _dy, _dz, _dx_2, _dy_2, _dz_2, alpha, delta, omega)

    # test against gold solution
    @test all(ux_gold .≈ Array(ux_init))
    @test all(uy_gold .≈ Array(uy_init))
    @test all(uz_gold .≈ Array(uz_init))
    @test all(vx_gold .≈ Array(vx_init))
    @test all(vy_gold .≈ Array(vy_init))
    @test all(vz_gold .≈ Array(vz_init))

    # unit tests 
    # test that the boundaries stayed constant from in the previous test
    @test all(ux_boundary[1,:,:] .≈ Array(ux_init[1,:,:]))
    @test all(ux_boundary[end,:,:] .≈ Array(ux_init[end,:,:]))
    @test all(ux_boundary[:,1,:] .≈ Array(ux_init[:,1,:]))
    @test all(ux_boundary[:,end,:] .≈ Array(ux_init[:,end,:]))
    @test all(ux_boundary[:,:,1] .≈ Array(ux_init[:,:,1]))
    @test all(ux_boundary[:,:,end] .≈ Array(ux_init[:,:,end]))

    @test all(uy_boundary[1,:,:] .≈ Array(uy_init[1,:,:]))
    @test all(uy_boundary[end,:,:] .≈ Array(uy_init[end,:,:]))
    @test all(uy_boundary[:,1,:] .≈ Array(uy_init[:,1,:]))
    @test all(uy_boundary[:,end,:] .≈ Array(uy_init[:,end,:]))
    @test all(uy_boundary[:,:,1] .≈ Array(uy_init[:,:,1]))
    @test all(uy_boundary[:,:,end] .≈ Array(uy_init[:,:,end]))

    @test all(uz_boundary[1,:,:] .≈ Array(uz_init[1,:,:]))
    @test all(uz_boundary[end,:,:] .≈ Array(uz_init[end,:,:]))
    @test all(uz_boundary[:,1,:] .≈ Array(uz_init[:,1,:]))
    @test all(uz_boundary[:,end,:] .≈ Array(uz_init[:,end,:]))
    @test all(uz_boundary[:,:,1] .≈ Array(uz_init[:,:,1]))
    @test all(uz_boundary[:,:,end] .≈ Array(uz_init[:,:,end]))

    @test all(vx_boundary[1,:,:] .≈ Array(vx_init[1,:,:]))
    @test all(vx_boundary[end,:,:] .≈ Array(vx_init[end,:,:]))
    @test all(vx_boundary[:,1,:] .≈ Array(vx_init[:,1,:]))
    @test all(vx_boundary[:,end,:] .≈ Array(vx_init[:,end,:]))
    @test all(vx_boundary[:,:,1] .≈ Array(vx_init[:,:,1]))
    @test all(vx_boundary[:,:,end] .≈ Array(vx_init[:,:,end]))

    @test all(vy_boundary[1,:,:] .≈ Array(vy_init[1,:,:]))
    @test all(vy_boundary[end,:,:] .≈ Array(vy_init[end,:,:]))
    @test all(vy_boundary[:,1,:] .≈ Array(vy_init[:,1,:]))
    @test all(vy_boundary[:,end,:] .≈ Array(vy_init[:,end,:]))
    @test all(vy_boundary[:,:,1] .≈ Array(vy_init[:,:,1]))
    @test all(vy_boundary[:,:,end] .≈ Array(vy_init[:,:,end]))

    @test all(vz_boundary[1,:,:] .≈ Array(vz_init[1,:,:]))
    @test all(vz_boundary[end,:,:] .≈ Array(vz_init[end,:,:]))
    @test all(vz_boundary[:,1,:] .≈ Array(vz_init[:,1,:]))
    @test all(vz_boundary[:,end,:] .≈ Array(vz_init[:,end,:]))
    @test all(vz_boundary[:,:,1] .≈ Array(vz_init[:,:,1]))
    @test all(vz_boundary[:,:,end] .≈ Array(vz_init[:,:,end]))
end

@testset "auxiliary" begin
    include("../src/auxiliary.jl")
    A = rand(3,3)
    B = similar(A)
    save_array("bin_io",A)
    load_array("bin_io",B)
    @test all(A .== B)
end